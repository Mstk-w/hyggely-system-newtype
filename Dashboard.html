<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hyggelyã‚«ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥å°‚é–€åº— ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v5.3.4</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    body {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
    }
    
    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    .navbar {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%) !important;
      box-shadow: 0 4px 20px rgba(139, 69, 19, 0.3);
    }
    .navbar-brand { font-weight: bold; color: white !important; }
    .nav-link {
      color: rgba(255, 255, 255, 0.9) !important;
      transition: all 0.3s ease;
      border-radius: 6px;
      margin: 0 3px;
      padding: 8px 12px !important;
    }
    .nav-link:hover {
      color: white !important;
      background: rgba(255, 255, 255, 0.1);
    }
    
    /* ã‚«ãƒ¼ãƒ‰ */
    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 1.5rem;
      background: rgba(255, 255, 255, 0.95);
      transition: all 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }
    .card-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid rgba(139, 69, 19, 0.1);
      font-weight: 700;
      padding: 1rem 1.5rem;
      border-radius: 12px 12px 0 0;
    }
    .card-body { padding: 1.5rem; }
    
    /* ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ« */
    .nav-pills .nav-link {
      color: #6c757d;
      border-radius: 8px;
      margin-right: 10px;
      padding: 12px 20px;
      font-weight: 600;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    .nav-pills .nav-link:hover {
      border-color: #8B4513;
      background: rgba(139, 69, 19, 0.05);
      transform: translateY(-1px);
    }
    .nav-pills .nav-link.active {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
      border-color: #8B4513;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
    }
    
    /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
    .stat-card {
      transition: all 0.3s ease;
      cursor: pointer;
      height: 100%;
    }
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }
    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0;
    }
    
    /* å¼•æ¸¡çŠ¶æ³ãƒãƒƒã‚¸ */
    .delivery-status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .status-pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .status-delivered {
      background: #d1edff;
      color: #0c5460;
      border: 1px solid #b8daff;
    }
    
    /* å¼•æ¸¡çŠ¶æ³å¤‰æ›´ãƒœã‚¿ãƒ³ */
    .delivery-actions {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }
    .delivery-btn {
      padding: 2px 6px;
      font-size: 0.7rem;
      border-radius: 4px;
      border: none;
      transition: all 0.2s ease;
    }
    .delivery-btn:hover {
      transform: translateY(-1px);
    }
    .btn-deliver {
      background: #28a745;
      color: white;
    }
    .btn-deliver:hover {
      background: #218838;
    }
    .btn-return {
      background: #ffc107;
      color: #212529;
    }
    .btn-return:hover {
      background: #e0a800;
    }
    
    /* ä¸€æ‹¬æ“ä½œãƒ‘ãƒãƒ« */
    .bulk-actions {
      background: #e3f2fd;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid #2196f3;
    }
    .bulk-actions.hidden {
      display: none;
    }
    
    /* é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
    .order-checkbox {
      transform: scale(1.2);
      margin-right: 8px;
    }
    
    /* ãƒœã‚¿ãƒ³ */
    .btn-primary {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .btn-primary:hover { transform: translateY(-1px); }
    
    /* ãƒ†ãƒ¼ãƒ–ãƒ« */
    .table { border-radius: 8px; overflow: hidden; }
    .table th {
      background: linear-gradient(135deg, #f8f6f0 0%, #f0ede5 100%);
      font-weight: 700;
      border: none;
      padding: 12px 8px;
      font-size: 0.9rem;
    }
    .table td { 
      padding: 10px 8px; 
      border-color: #f0f0f0; 
      font-size: 0.85rem;
      vertical-align: middle;
    }
    
    /* äºˆç´„ãƒ†ãƒ¼ãƒ–ãƒ«ã®æœ€é©åŒ– */
    .orders-table {
      font-size: 0.8rem;
    }
    .orders-table .pickup-date {
      font-weight: bold;
      color: #8B4513;
      font-size: 0.9rem;
    }
    .orders-table .pickup-time {
      color: #666;
      font-size: 0.75rem;
    }
    .orders-table .customer-name {
      font-weight: 600;
      color: #333;
    }
    .orders-table .customer-email {
      color: #666;
      font-size: 0.7rem;
    }
    .orders-table .order-id {
      font-family: 'Courier New', monospace;
      font-size: 0.7rem;
      background: #f8f9fa;
      padding: 2px 4px;
      border-radius: 3px;
      color: #495057;
    }
    .orders-table .order-items {
      max-height: 80px;
      overflow-y: auto;
      font-size: 0.75rem;
      line-height: 1.3;
      white-space: pre-line;
    }
    
    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    .loading {
      display: none;
      text-align: center;
      padding: 3rem;
    }
    .loading.show { display: block; }
    
    /* ã‚¨ãƒ©ãƒ¼è¡¨ç¤º */
    .error-container {
      display: none;
      text-align: center;
      padding: 3rem;
      background: #fff;
      border-radius: 15px;
      margin: 2rem 0;
    }
    .error-container.show { display: block; }
    .error-icon {
      font-size: 4rem;
      color: #dc3545;
      margin-bottom: 1rem;
    }
    
    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
    .status-indicator {
      position: fixed;
      top: 70px;
      right: 15px;
      z-index: 1000;
      background: rgba(40, 167, 69, 0.9);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }
    
    /* ãƒãƒƒã‚¸ */
    .stock-ok { background-color: #28a745; }
    .stock-low { background-color: #ffc107; color: #000; }
    .stock-out { background-color: #dc3545; }
    
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æœ€é©åŒ– */
    @media (max-width: 768px) {
      .container-fluid { padding: 0.5rem; }
      .card { margin-bottom: 1rem; }
      .card-body { padding: 1rem; }
      .stat-number { font-size: 1.5rem; }
      .table th, .table td {
        padding: 6px 4px;
        font-size: 0.8rem;
      }
      .navbar-brand { font-size: 1rem; }
      .nav-link { padding: 6px 8px !important; }
      .delivery-actions {
        flex-direction: column;
        align-items: stretch;
      }
      .orders-table .order-items {
        max-height: 60px;
      }
    }
    
    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.05); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* ã‚«ã‚¹ã‚¿ãƒ è¦ç´  */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .quick-stat {
      text-align: center;
      padding: 1rem;
      background: white;
      border-radius: 8px;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }
    
    .quick-stat:hover {
      border-color: #8B4513;
      box-shadow: 0 4px 15px rgba(139, 69, 19, 0.1);
    }
    
    /* ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤º */
    .version-info {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
    }

    /* ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ«å¼·åŒ– */
    .debug-info {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 1rem;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      max-height: 400px;
      overflow-y: auto;
    }
    .debug-info pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .debug-highlight {
      background: #fff3cd;
      color: #856404;
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤º -->
  <div class="version-info">v5.3.4</div>
  
  <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
  <div class="status-indicator pulse" id="status">
    <i class="bi bi-wifi"></i> æ¥ç¶šä¸­
  </div>

  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <i class="bi bi-shop me-2"></i>Hyggelyç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v5.3.4
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="?" target="_blank">
            <i class="bi bi-box-arrow-up-right me-1"></i>äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ 
          </a>
          <a class="nav-link" href="#" onclick="refreshAllData()">
            <i class="bi bi-arrow-clockwise me-1"></i>æ›´æ–°
          </a>
          <a class="nav-link" href="#" onclick="debugData()">
            <i class="bi bi-bug me-1"></i>ãƒ‡ãƒãƒƒã‚°
          </a>
          <a class="nav-link" href="#" onclick="exportData()">
            <i class="bi bi-download me-1"></i>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
          </a>
          <a class="nav-link" href="#" onclick="clearSystemCache()">
            <i class="bi bi-trash me-1"></i>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid py-3">
    <!-- åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
    <div class="error-container" id="init-error">
      <div class="error-icon">âš ï¸</div>
      <h3>åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼</h3>
      <p id="init-error-message">Google Apps Scriptã¨ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>
      <div class="retry-section">
        <button class="btn btn-primary me-2" onclick="retryInitialization()">
          <i class="bi bi-arrow-clockwise me-1"></i>å†è©¦è¡Œ
        </button>
        <button class="btn btn-outline-secondary" onclick="useOfflineMode()">
          <i class="bi bi-wifi-off me-1"></i>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ç¶šè¡Œ
        </button>
      </div>
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ãƒ‘ãƒãƒ« -->
    <div class="card mb-3" id="debug-panel" style="display: none;">
      <div class="card-header">
        <i class="bi bi-bug me-2"></i>ãƒ‡ãƒãƒƒã‚°æƒ…å ± v5.3.4 - GASæœ€é©åŒ–ç‰ˆ
        <button class="btn btn-sm btn-outline-secondary float-end" onclick="hideDebugPanel()">
          <i class="bi bi-x"></i> é–‰ã˜ã‚‹
        </button>
      </div>
      <div class="card-body">
        <div class="alert alert-info">
          <h6><i class="bi bi-info-circle me-2"></i>ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã«ã¤ã„ã¦</h6>
          <p class="mb-0">
            çµ±è¨ˆã§ã¯ã€Œä»Šæ—¥ã®äºˆç´„: 4ã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã®ã«ã€ã€Œæœ€è¿‘ã®äºˆç´„ã€ãŒè¡¨ç¤ºã•ã‚Œãªã„å•é¡Œã‚’èª¿æŸ»ã—ã¾ã™ã€‚<br>
            <span class="debug-highlight">getOrderList()ã¨çµ±è¨ˆè¨ˆç®—ã®æ•´åˆæ€§</span>ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
          </p>
        </div>
        <div id="debug-content" class="debug-info">
          ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...
        </div>
      </div>
    </div>

    <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <ul class="nav nav-pills mb-3" id="dashboardTabs">
      <li class="nav-item">
        <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview">
          <i class="bi bi-house-door me-1"></i>æ¦‚è¦
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="orders-tab" data-bs-toggle="pill" data-bs-target="#orders">
          <i class="bi bi-list-check me-1"></i>äºˆç´„ç®¡ç†
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="inventory-tab" data-bs-toggle="pill" data-bs-target="#inventory">
          <i class="bi bi-box-seam me-1"></i>åœ¨åº«ç®¡ç†
        </button>
      </li>
    </ul>

    <!-- ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="tab-content" id="dashboardTabContent">
      <!-- æ¦‚è¦ã‚¿ãƒ– -->
      <div class="tab-pane fade show active" id="overview">
        <div class="loading" id="overview-loading">
          <div class="spinner-border" style="color: #8B4513;"></div>
          <p class="mt-3">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
        </div>

        <div id="overview-content" style="display: none;">
          <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
          <div class="quick-stats mb-4" id="stats-container">
            <div class="quick-stat border-primary">
              <i class="bi bi-calendar-check text-primary" style="font-size: 2rem;"></i>
              <p class="stat-number text-primary" id="today-orders">0</p>
              <p class="mb-0 fw-semibold">ä»Šæ—¥ã®äºˆç´„</p>
            </div>
            <div class="quick-stat border-warning">
              <i class="bi bi-clock text-warning" style="font-size: 2rem;"></i>
              <p class="stat-number text-warning" id="pending-orders">0</p>
              <p class="mb-0 fw-semibold">æœªå¼•æ¸¡</p>
            </div>
            <div class="quick-stat border-info">
              <i class="bi bi-check-circle text-info" style="font-size: 2rem;"></i>
              <p class="stat-number text-info" id="delivered-orders">0</p>
              <p class="mb-0 fw-semibold">å¼•æ¸¡æ¸ˆ</p>
            </div>
            <div class="quick-stat border-success">
              <i class="bi bi-currency-yen text-success" style="font-size: 2rem;"></i>
              <p class="stat-number text-success" id="month-revenue">Â¥0</p>
              <p class="mb-0 fw-semibold">ä»Šæœˆã®å£²ä¸Š</p>
            </div>
            <div class="quick-stat border-success">
              <i class="bi bi-cash text-success" style="font-size: 2rem;"></i>
              <p class="stat-number text-success" id="today-revenue">Â¥0</p>
              <p class="mb-0 fw-semibold">ä»Šæ—¥ã®å£²ä¸Š</p>
            </div>
            <div class="quick-stat border-danger">
              <i class="bi bi-exclamation-triangle text-danger" style="font-size: 2rem;"></i>
              <p class="stat-number text-danger" id="stock-alerts">0</p>
              <p class="mb-0 fw-semibold">åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆ</p>
            </div>
          </div>

          <!-- åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆ -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <span><i class="bi bi-exclamation-triangle text-danger me-2"></i>åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆ</span>
                  <button class="btn btn-sm btn-outline-primary" onclick="loadOverviewData()">
                    <i class="bi bi-arrow-clockwise"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div id="stock-alerts-content">
                    <div class="text-center text-muted">èª­ã¿è¾¼ã¿ä¸­...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æœ€è¿‘ã®äºˆç´„ -->
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <span><i class="bi bi-clock-history me-2"></i>æœ€è¿‘ã®äºˆç´„ï¼ˆæœªå¼•æ¸¡ãƒ»å—å–æ—¥æ™‚æ˜‡é †ãƒ»ç›´è¿‘10ä»¶ï¼‰</span>
                  <div>
                    <button class="btn btn-sm btn-warning me-2" onclick="forceReloadOrders()">
                      <i class="bi bi-exclamation-triangle me-1"></i>å¼·åˆ¶å†èª­ã¿è¾¼ã¿
                    </button>
                    <button class="btn btn-sm btn-outline-primary" onclick="loadOverviewData()">
                      <i class="bi bi-arrow-clockwise"></i>
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <div id="recent-orders">
                    <div class="text-center text-muted">èª­ã¿è¾¼ã¿ä¸­...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- äºˆç´„ç®¡ç†ã‚¿ãƒ– -->
      <div class="tab-pane fade" id="orders">
        <div class="loading" id="orders-loading">
          <div class="spinner-border" style="color: #8B4513;"></div>
          <p class="mt-3">äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
        </div>

        <div id="orders-content" style="display: none;">
          <!-- ä¸€æ‹¬æ“ä½œãƒ‘ãƒãƒ« -->
          <div class="bulk-actions hidden" id="bulk-actions-panel">
            <h6><i class="bi bi-check2-square me-2"></i>ä¸€æ‹¬æ“ä½œ</h6>
            <p class="mb-2">é¸æŠã•ã‚ŒãŸäºˆç´„: <span id="selected-count">0</span>ä»¶</p>
            <div class="d-flex gap-2 flex-wrap">
              <button class="btn btn-success btn-sm" onclick="bulkDelivery()">
                <i class="bi bi-check-circle me-1"></i>ä¸€æ‹¬å¼•æ¸¡æ¸ˆ
              </button>
              <button class="btn btn-warning btn-sm" onclick="bulkReturn()">
                <i class="bi bi-arrow-clockwise me-1"></i>ä¸€æ‹¬æœªå¼•æ¸¡ã«æˆ»ã™
              </button>
              <button class="btn btn-outline-secondary btn-sm" onclick="clearSelection()">
                <i class="bi bi-x me-1"></i>é¸æŠè§£é™¤
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span><i class="bi bi-list-check me-2"></i>äºˆç´„ä¸€è¦§ç®¡ç†ï¼ˆå—å–æ—¥æ™‚æ˜‡é †ï¼‰</span>
              <div>
                <button class="btn btn-sm btn-success me-2" onclick="exportOrdersData()">
                  <i class="bi bi-download me-1"></i>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
                <button class="btn btn-sm btn-outline-primary" onclick="loadOrdersData()">
                  <i class="bi bi-arrow-clockwise me-1"></i>æ›´æ–°
                </button>
              </div>
            </div>
            <div class="card-body">
              <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
              <div class="row mb-3">
                <div class="col-md-3">
                  <select class="form-select" id="order-status-filter" onchange="applyOrderFilters()">
                    <option value="pending">æœªå¼•æ¸¡ã®ã¿</option>
                    <option value="delivered">å¼•æ¸¡æ¸ˆã®ã¿</option>
                    <option value="all">å…¨ã¦ã®çŠ¶æ…‹</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <input type="date" class="form-control" id="order-date-filter" onchange="applyOrderFilters()">
                </div>
                <div class="col-md-4">
                  <input type="text" class="form-control" id="order-search" placeholder="é¡§å®¢åãƒ»ãƒ¡ãƒ¼ãƒ«ã§æ¤œç´¢" oninput="applyOrderFilters()">
                </div>
                <div class="col-md-2">
                  <button class="btn btn-primary w-100" onclick="applyOrderFilters()">
                    <i class="bi bi-search"></i> æ¤œç´¢
                  </button>
                </div>
              </div>
              
              <!-- äºˆç´„ãƒ†ãƒ¼ãƒ–ãƒ« -->
              <div class="table-responsive">
                <table class="table table-hover orders-table">
                  <thead>
                    <tr>
                      <th>
                        <input type="checkbox" class="form-check-input" id="select-all" onchange="toggleSelectAll()">
                      </th>
                      <th>å—å–æ—¥æ™‚</th>
                      <th>ãŠå®¢æ§˜</th>
                      <th>å•†å“</th>
                      <th>é‡‘é¡</th>
                      <th>çŠ¶æ…‹</th>
                      <th>äºˆç´„ID</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="orders-table-body">
                    <tr><td colspan="8" class="text-center">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
                  </tbody>
                </table>
              </div>
              
              <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
              <nav aria-label="äºˆç´„ä¸€è¦§ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³">
                <ul class="pagination justify-content-center" id="orders-pagination">
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <!-- åœ¨åº«ç®¡ç†ã‚¿ãƒ– -->
      <div class="tab-pane fade" id="inventory">
        <div class="loading" id="inventory-loading">
          <div class="spinner-border" style="color: #8B4513;"></div>
          <p class="mt-3">åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
        </div>

        <div id="inventory-content" style="display: none;">
          <!-- åœ¨åº«ä¸€è¦§ -->
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span><i class="bi bi-box-seam me-2"></i>åœ¨åº«ç®¡ç†</span>
              <button class="btn btn-sm btn-outline-primary" onclick="loadInventoryData()">
                <i class="bi bi-arrow-clockwise me-1"></i>æ›´æ–°
              </button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>å•†å“å</th>
                      <th>å˜ä¾¡</th>
                      <th>åœ¨åº«æ•°</th>
                      <th>äºˆç´„æ•°</th>
                      <th>æ®‹æ•°</th>
                      <th>æœ€ä½åœ¨åº«</th>
                      <th>çŠ¶æ…‹</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="inventory-table-body">
                    <tr><td colspan="8" class="text-center text-muted py-4">åœ¨åº«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- åœ¨åº«æ›´æ–°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal fade" id="stockModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">åœ¨åº«æ•°æ›´æ–°</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="stock-form">
            <input type="hidden" id="stock-product-id">
            <div class="mb-3">
              <label class="form-label">å•†å“å</label>
              <input type="text" class="form-control" id="stock-product-name" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">ç¾åœ¨ã®åœ¨åº«æ•°</label>
              <input type="number" class="form-control" id="stock-current" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">æ–°ã—ã„åœ¨åº«æ•°</label>
              <input type="number" class="form-control" id="stock-new" min="0" required>
            </div>
            <div class="mb-3">
              <label class="form-label">æœ€ä½åœ¨åº«æ•°</label>
              <input type="number" class="form-control" id="stock-min" min="0" value="3">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button type="button" class="btn btn-primary" onclick="updateStockData()">æ›´æ–°</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ç®¡ç†ï¼ˆv5.3.4å¯¾å¿œï¼‰
    let currentData = { stats: {}, orders: [], inventory: [], products: [] };
    let updateInterval;
    let currentOrderPage = 1;
    const ordersPerPage = 20;
    let isOnline = true;
    let systemInitialized = false;
    let retryCount = 0;
    const maxRetries = 3;
    let selectedOrders = new Set();

    // åˆæœŸåŒ–ï¼ˆv5.3.4ï¼‰
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èµ·å‹• v5.3.4 - GASæœ€é©åŒ–ç‰ˆ');
      
      // æ¥ç¶šçŠ¶æ…‹ç›£è¦–
      initializeConnectionMonitor();
      
      // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
      initializeSystem();
      
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
      setupEventListeners();
      
      // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿è©¦è¡Œ
      attemptDataLoad();
    });

    // æ¥ç¶šçŠ¶æ…‹ç›£è¦–
    function initializeConnectionMonitor() {
      window.addEventListener('online', function() {
        isOnline = true;
        if (!systemInitialized) {
          attemptDataLoad();
        }
      });
      
      window.addEventListener('offline', function() {
        isOnline = false;
      });
    }

    // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
    function initializeSystem() {
      try {
        if (typeof google === 'undefined' || !google.script || !google.script.run) {
          console.warn('âš ï¸ Google Apps Scriptç’°å¢ƒãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
          throw new Error('Google Apps Scriptç’°å¢ƒãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
        }
        
        console.log('âœ… Google Apps Scriptç’°å¢ƒã‚’ç¢ºèªã—ã¾ã—ãŸ');
        return true;
      } catch (error) {
        console.error('âŒ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        return false;
      }
    }

    // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿è©¦è¡Œ
    function attemptDataLoad() {
      if (!isOnline) {
        return;
      }
      
      if (retryCount >= maxRetries) {
        showInitError('æœ€å¤§è©¦è¡Œå›æ•°ã«åˆ°é”ã—ã¾ã—ãŸã€‚ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚');
        return;
      }
      
      retryCount++;
      updateStatus(`åˆæœŸåŒ–è©¦è¡Œ ${retryCount}/${maxRetries}`, 'loading');
      
      setTimeout(() => {
        testGoogleScriptConnection()
          .then(() => {
            console.log('âœ… Google Apps Scriptæ¥ç¶šæˆåŠŸ');
            systemInitialized = true;
            hideInitError();
            loadTabData('overview');
            startAutoUpdate();
            updateStatus('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èµ·å‹•å®Œäº†', 'success');
          })
          .catch(error => {
            console.error('âŒ Google Apps Scriptæ¥ç¶šå¤±æ•—:', error);
            if (retryCount < maxRetries) {
              updateStatus(`æ¥ç¶šå¤±æ•—ã€å†è©¦è¡Œä¸­... (${retryCount}/${maxRetries})`, 'loading');
              setTimeout(() => attemptDataLoad(), 2000 * retryCount);
            } else {
              showInitError('Google Apps Scriptã¨ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
          });
      }, 1000);
    }

    // Google Apps Scriptæ¥ç¶šãƒ†ã‚¹ãƒˆ
    function testGoogleScriptConnection() {
      return new Promise((resolve, reject) => {
        try {
          const timeout = setTimeout(() => {
            reject(new Error('æ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
          }, 10000);
          
          google.script.run
            .withSuccessHandler(function(result) {
              clearTimeout(timeout);
              resolve(result);
            })
            .withFailureHandler(function(error) {
              clearTimeout(timeout);
              reject(error);
            })
            .testConnection();
        } catch (error) {
          reject(error);
        }
      });
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
    function setupEventListeners() {
      document.querySelectorAll('[data-bs-toggle="pill"]').forEach(tab => {
        tab.addEventListener('shown.bs.tab', function(event) {
          const targetId = event.target.getAttribute('data-bs-target').substring(1);
          if (systemInitialized) {
            loadTabData(targetId);
          }
        });
      });
    }

    // ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    function loadTabData(tabId) {
      if (!systemInitialized) {
        console.log('âš ï¸ ã‚·ã‚¹ãƒ†ãƒ æœªåˆæœŸåŒ–ã®ãŸã‚ã€ã‚¿ãƒ–ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');
        return;
      }
      
      switch(tabId) {
        case 'overview': 
          loadOverviewData(); 
          break;
        case 'orders': 
          loadOrdersData(); 
          break;
        case 'inventory': 
          loadInventoryData(); 
          break;
      }
    }

    // æ¦‚è¦ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    function loadOverviewData() {
      showLoading('overview');
      updateStatus('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­', 'loading');
      
      Promise.all([
        safeCallGoogleScript('getDashboardStats'),
        safeCallGoogleScript('getInventoryDataForForm'),
        safeCallGoogleScript('getOrderList')
      ]).then(([stats, inventory, orders]) => {
        console.log('ğŸ“Š å–å¾—ãƒ‡ãƒ¼ã‚¿:', { 
          stats: stats, 
          inventoryCount: inventory?.length || 0, 
          ordersCount: orders?.length || 0 
        });
        
        currentData = { 
          stats: stats || {}, 
          inventory: inventory || [], 
          orders: orders || [] 
        };
        
        console.log('ğŸ“Š çµ±è¨ˆãƒ‡ãƒ¼ã‚¿è¡¨ç¤º:', stats);
        
        renderOverview();
        hideLoading('overview');
        updateStatus('æ›´æ–°å®Œäº†', 'success');
      }).catch(error => {
        console.error('æ¦‚è¦ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        showError('overview', 'çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error);
        updateStatus('å–å¾—ã‚¨ãƒ©ãƒ¼', 'error');
      });
    }

    // ğŸ”§ å¼·åˆ¶çš„ãªäºˆç´„ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
    function forceReloadOrders() {
      updateStatus('äºˆç´„ãƒ‡ãƒ¼ã‚¿å¼·åˆ¶å†èª­ã¿è¾¼ã¿ä¸­', 'loading');
      
      // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
      safeCallGoogleScript('clearCache')
        .then(() => {
          console.log('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Œäº†');
          // äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥å–å¾—
          return safeCallGoogleScript('getOrderList');
        })
        .then(orders => {
          console.log('ğŸ”§ å¼·åˆ¶å†èª­ã¿è¾¼ã¿çµæœ:', orders);
          currentData.orders = orders || [];
          renderRecentOrders(orders?.slice(0, 10) || []);
          updateStatus('å¼·åˆ¶å†èª­ã¿è¾¼ã¿å®Œäº†', 'success');
          showToast(`äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’å¼·åˆ¶å†èª­ã¿è¾¼ã¿ã—ã¾ã—ãŸï¼ˆ${orders?.length || 0}ä»¶ï¼‰`, 'success');
        })
        .catch(error => {
          console.error('å¼·åˆ¶å†èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
          updateStatus('å¼·åˆ¶å†èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼', 'error');
          showToast('å¼·åˆ¶å†èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        });
    }

    // æ¦‚è¦è¡¨ç¤º
    function renderOverview() {
      const stats = currentData.stats;
      const inventory = currentData.inventory;
      const orders = currentData.orders;

      console.log('ğŸ“Š çµ±è¨ˆãƒ‡ãƒ¼ã‚¿è¡¨ç¤º:', stats);

      // çµ±è¨ˆè¡¨ç¤º
      document.getElementById('today-orders').textContent = stats.todayOrdersCount || 0;
      document.getElementById('pending-orders').textContent = stats.pendingOrdersCount || 0;
      document.getElementById('delivered-orders').textContent = stats.deliveredOrdersCount || 0;
      document.getElementById('month-revenue').textContent = `Â¥${(stats.monthRevenue || 0).toLocaleString()}`;
      document.getElementById('today-revenue').textContent = `Â¥${(stats.todayRevenue || 0).toLocaleString()}`;
      document.getElementById('stock-alerts').textContent = (stats.outOfStockCount || 0) + (stats.lowStockCount || 0);

      // åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆ
      renderStockAlerts(inventory);
      
      // æœ€è¿‘ã®äºˆç´„
      console.log('ğŸ“Š æœ€è¿‘ã®äºˆç´„è¡¨ç¤º:', orders?.length || 0, 'ä»¶');
      renderRecentOrders(orders?.slice(0, 10) || []);
    }

    // åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
    function renderStockAlerts(inventory) {
      const container = document.getElementById('stock-alerts-content');
      
      const outOfStock = inventory.filter(p => p.remaining <= 0);
      const lowStock = inventory.filter(p => p.remaining > 0 && p.remaining <= (p.minStock || 3));
      
      if (outOfStock.length === 0 && lowStock.length === 0) {
        container.innerHTML = '<div class="text-center text-success"><i class="bi bi-check-circle me-2"></i>åœ¨åº«ã«å•é¡Œã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      let html = '';
      
      if (outOfStock.length > 0) {
        html += '<div class="alert alert-danger mb-2"><h6>åœ¨åº«åˆ‡ã‚Œ</h6><ul class="mb-0">';
        outOfStock.forEach(item => {
          html += `<li>${item.name}</li>`;
        });
        html += '</ul></div>';
      }
      
      if (lowStock.length > 0) {
        html += '<div class="alert alert-warning mb-2"><h6>åœ¨åº«å°‘</h6><ul class="mb-0">';
        lowStock.forEach(item => {
          html += `<li>${item.name} (æ®‹ã‚Š${item.remaining}å€‹)</li>`;
        });
        html += '</ul></div>';
      }
      
      container.innerHTML = html;
    }

    // æœ€è¿‘ã®äºˆç´„è¡¨ç¤ºï¼ˆå¼·åŒ–ç‰ˆï¼‰
    function renderRecentOrders(orders) {
      const container = document.getElementById('recent-orders');
      
      console.log('ğŸ“Š æœ€è¿‘ã®äºˆç´„è¡¨ç¤ºå‡¦ç†:', orders);
      
      if (!orders || orders.length === 0) {
        container.innerHTML = `
          <div class="alert alert-warning">
            <h6><i class="bi bi-exclamation-triangle me-2"></i>äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h6>
            <p class="mb-2">çµ±è¨ˆã§ã¯ã€Œä»Šæ—¥ã®äºˆç´„: ${currentData.stats?.todayOrdersCount || 0}ã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ãŒã€æœ€è¿‘ã®äºˆç´„ä¸€è¦§ã«ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
            <button class="btn btn-warning btn-sm" onclick="forceReloadOrders()">
              <i class="bi bi-arrow-clockwise me-1"></i>å¼·åˆ¶å†èª­ã¿è¾¼ã¿
            </button>
            <button class="btn btn-info btn-sm ms-2" onclick="debugData()">
              <i class="bi bi-bug me-1"></i>ãƒ‡ãƒãƒƒã‚°æƒ…å ±ç¢ºèª
            </button>
          </div>
        `;
        return;
      }
      
      let html = '<div class="table-responsive"><table class="table table-sm">';
      html += '<thead><tr><th>å—å–æ—¥æ™‚</th><th>ãŠå®¢æ§˜</th><th>å•†å“</th><th>é‡‘é¡</th><th>çŠ¶æ…‹</th><th>äºˆç´„ID</th></tr></thead><tbody>';
      
      orders.forEach(order => {
        const pickupDateTime = `${order.pickupDate} ${order.pickupTime}`;
        const customerName = `${order.lastName} ${order.firstName}`;
        
        html += `
          <tr>
            <td class="pickup-date">${pickupDateTime}</td>
            <td>
              <div class="customer-name">${customerName}</div>
              <div class="customer-email">${order.email}</div>
            </td>
            <td>
              <div class="order-items">${order.productsDisplay || 'å•†å“æƒ…å ±ãªã—'}</div>
            </td>
            <td><strong>Â¥${order.totalPrice.toLocaleString()}</strong></td>
            <td>
              <span class="delivery-status status-pending">${order.deliveryStatus || 'æœªå¼•æ¸¡'}</span>
            </td>
            <td>
              <div class="order-id">${order.orderId}</div>
            </td>
          </tr>
        `;
      });
      
      html += '</tbody></table></div>';
      container.innerHTML = html;
      
      console.log('âœ… æœ€è¿‘ã®äºˆç´„è¡¨ç¤ºå®Œäº†:', orders.length, 'ä»¶');
    }

    // äºˆç´„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    function loadOrdersData() {
      showLoading('orders');
      updateStatus('äºˆç´„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­', 'loading');
      
      const filterType = document.getElementById('order-status-filter').value || 'pending';
      
      safeCallGoogleScript('getFilteredOrders', filterType)
        .then(orders => {
          console.log('ğŸ“‹ äºˆç´„ãƒ‡ãƒ¼ã‚¿å–å¾—:', orders);
          currentData.orders = orders || [];
          renderOrders();
          hideLoading('orders');
          updateStatus('æ›´æ–°å®Œäº†', 'success');
        })
        .catch(error => {
          console.error('äºˆç´„ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
          showError('orders', 'äºˆç´„ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error);
          updateStatus('å–å¾—ã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    // äºˆç´„ä¸€è¦§è¡¨ç¤º
    function renderOrders() {
      const tbody = document.getElementById('orders-table-body');
      const orders = currentData.orders || [];
      
      if (orders.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted py-4">äºˆç´„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
        return;
      }
      
      let html = '';
      orders.forEach((order, index) => {
        const pickupDateTime = `${order.pickupDate} ${order.pickupTime}`;
        const customerName = `${order.lastName} ${order.firstName}`;
        
        html += `
          <tr>
            <td>
              <input type="checkbox" class="form-check-input order-checkbox" 
                     value="${order.orderId}" onchange="toggleOrderSelection('${order.orderId}')">
            </td>
            <td>
              <div class="pickup-date">${order.pickupDate}</div>
              <div class="pickup-time">${order.pickupTime}</div>
            </td>
            <td>
              <div class="customer-name">${customerName}</div>
              <div class="customer-email">${order.email}</div>
            </td>
            <td>
              <div class="order-items">${order.productsDisplay || 'å•†å“æƒ…å ±ãªã—'}</div>
            </td>
            <td><strong>Â¥${order.totalPrice.toLocaleString()}</strong></td>
            <td>
              <span class="delivery-status ${order.deliveryStatus === 'å¼•æ¸¡æ¸ˆ' ? 'status-delivered' : 'status-pending'}">
                ${order.deliveryStatus || 'æœªå¼•æ¸¡'}
              </span>
            </td>
            <td>
              <div class="order-id">${order.orderId}</div>
            </td>
            <td>
              <div class="delivery-actions">
                ${order.deliveryStatus === 'æœªå¼•æ¸¡' ? 
                  `<button class="delivery-btn btn-deliver" onclick="changeDeliveryStatus('${order.orderId}', 'å¼•æ¸¡æ¸ˆ')">
                    <i class="bi bi-check"></i> å¼•æ¸¡æ¸ˆ
                  </button>` :
                  `<button class="delivery-btn btn-return" onclick="changeDeliveryStatus('${order.orderId}', 'æœªå¼•æ¸¡')">
                    <i class="bi bi-arrow-clockwise"></i> æœªå¼•æ¸¡
                  </button>`
                }
              </div>
            </td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    }

    // åœ¨åº«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    function loadInventoryData() {
      showLoading('inventory');
      updateStatus('åœ¨åº«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­', 'loading');
      
      safeCallGoogleScript('getInventoryDataForForm')
        .then(inventory => {
          currentData.inventory = inventory || [];
          renderInventory();
          hideLoading('inventory');
          updateStatus('æ›´æ–°å®Œäº†', 'success');
        })
        .catch(error => {
          console.error('åœ¨åº«ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
          showError('inventory', 'åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
          updateStatus('å–å¾—ã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    // åœ¨åº«ä¸€è¦§è¡¨ç¤º
    function renderInventory() {
      const tbody = document.getElementById('inventory-table-body');
      const inventory = currentData.inventory || [];
      
      if (inventory.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted py-4">åœ¨åº«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
        return;
      }
      
      let html = '';
      inventory.forEach(item => {
        let stockBadge = '';
        if (item.remaining <= 0) {
          stockBadge = '<span class="badge stock-out">åœ¨åº«ãªã—</span>';
        } else if (item.remaining <= (item.minStock || 3)) {
          stockBadge = `<span class="badge stock-low">æ®‹ã‚Š${item.remaining}å€‹</span>`;
        } else {
          stockBadge = '<span class="badge stock-ok">ååˆ†</span>';
        }
        
        html += `
          <tr>
            <td><strong>${item.name}</strong></td>
            <td>Â¥${item.price.toLocaleString()}</td>
            <td>${item.stock}</td>
            <td>${item.reserved}</td>
            <td><strong>${item.remaining}</strong></td>
            <td>${item.minStock || 3}</td>
            <td>${stockBadge}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary" onclick="editStock('${item.id}')">
                <i class="bi bi-pencil"></i> ç·¨é›†
              </button>
            </td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    }

    // åœ¨åº«ç·¨é›†
    function editStock(productId) {
      const item = currentData.inventory.find(inv => inv.id === productId);
      if (!item) return;
      
      document.getElementById('stock-product-id').value = item.id;
      document.getElementById('stock-product-name').value = item.name;
      document.getElementById('stock-current').value = item.stock;
      document.getElementById('stock-new').value = item.stock;
      document.getElementById('stock-min').value = item.minStock || 3;
      
      const modal = new bootstrap.Modal(document.getElementById('stockModal'));
      modal.show();
    }

    // åœ¨åº«æ›´æ–°å®Ÿè¡Œ
    function updateStockData() {
      const productId = document.getElementById('stock-product-id').value;
      const newStock = parseInt(document.getElementById('stock-new').value);
      const minStock = parseInt(document.getElementById('stock-min').value);
      
      if (!productId || isNaN(newStock) || newStock < 0) {
        showToast('æ­£ã—ã„åœ¨åº«æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }
      
      updateStatus('åœ¨åº«æ›´æ–°ä¸­', 'loading');
      
      safeCallGoogleScript('updateStock', productId, newStock, minStock)
        .then(result => {
          if (result && result.success) {
            showToast(result.message, 'success');
            updateStatus('æ›´æ–°å®Œäº†', 'success');
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            const modal = bootstrap.Modal.getInstance(document.getElementById('stockModal'));
            modal.hide();
            
            // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
            loadInventoryData();
          } else {
            showToast(result ? result.message : 'åœ¨åº«æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            updateStatus('æ›´æ–°ã‚¨ãƒ©ãƒ¼', 'error');
          }
        })
        .catch(error => {
          console.error('åœ¨åº«æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
          showToast('åœ¨åº«æ›´æ–°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
          updateStatus('æ›´æ–°ã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    // å¼•æ¸¡çŠ¶æ³å¤‰æ›´
    function changeDeliveryStatus(orderId, newStatus) {
      updateStatus('å¼•æ¸¡çŠ¶æ³å¤‰æ›´ä¸­', 'loading');
      
      safeCallGoogleScript('updateDeliveryStatus', orderId, newStatus)
        .then(result => {
          if (result && result.success) {
            showToast(result.message, 'success');
            updateStatus('å¤‰æ›´å®Œäº†', 'success');
            
            loadOrdersData();
            loadOverviewData();
          } else {
            showToast(result ? result.message : 'å¼•æ¸¡çŠ¶æ³ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            updateStatus('å¤‰æ›´ã‚¨ãƒ©ãƒ¼', 'error');
          }
        })
        .catch(error => {
          console.error('å¼•æ¸¡çŠ¶æ³å¤‰æ›´ã‚¨ãƒ©ãƒ¼:', error);
          showToast('å¼•æ¸¡çŠ¶æ³ã®å¤‰æ›´ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
          updateStatus('å¤‰æ›´ã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    // äºˆç´„é¸æŠç®¡ç†
    function toggleOrderSelection(orderId) {
      if (selectedOrders.has(orderId)) {
        selectedOrders.delete(orderId);
      } else {
        selectedOrders.add(orderId);
      }
      
      updateBulkActionsPanel();
    }

    function toggleSelectAll() {
      const selectAllCheckbox = document.getElementById('select-all');
      const orderCheckboxes = document.querySelectorAll('.order-checkbox');
      
      if (selectAllCheckbox.checked) {
        orderCheckboxes.forEach(checkbox => {
          checkbox.checked = true;
          selectedOrders.add(checkbox.value);
        });
      } else {
        orderCheckboxes.forEach(checkbox => {
          checkbox.checked = false;
          selectedOrders.delete(checkbox.value);
        });
        selectedOrders.clear();
      }
      
      updateBulkActionsPanel();
    }

    function updateBulkActionsPanel() {
      const panel = document.getElementById('bulk-actions-panel');
      const countSpan = document.getElementById('selected-count');
      
      if (selectedOrders.size > 0) {
        panel.classList.remove('hidden');
        countSpan.textContent = selectedOrders.size;
      } else {
        panel.classList.add('hidden');
      }
    }

    function clearSelection() {
      selectedOrders.clear();
      document.querySelectorAll('.order-checkbox').forEach(checkbox => {
        checkbox.checked = false;
      });
      document.getElementById('select-all').checked = false;
      updateBulkActionsPanel();
    }

    // ä¸€æ‹¬æ“ä½œ
    function bulkDelivery() {
      if (selectedOrders.size === 0) {
        showToast('äºˆç´„ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
        return;
      }
      
      if (!confirm(`é¸æŠã•ã‚ŒãŸ${selectedOrders.size}ä»¶ã®äºˆç´„ã‚’ä¸€æ‹¬ã§ã€Œå¼•æ¸¡æ¸ˆã€ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ`)) {
        return;
      }
      
      updateStatus('ä¸€æ‹¬å¼•æ¸¡å‡¦ç†ä¸­', 'loading');
      
      const orderIds = Array.from(selectedOrders);
      safeCallGoogleScript('bulkUpdateDeliveryStatus', orderIds, 'å¼•æ¸¡æ¸ˆ')
        .then(result => {
          if (result && result.success) {
            showToast(`ä¸€æ‹¬å‡¦ç†å®Œäº†: æˆåŠŸ${result.successCount}ä»¶`, 'success');
            updateStatus('ä¸€æ‹¬å‡¦ç†å®Œäº†', 'success');
            
            clearSelection();
            loadOrdersData();
            loadOverviewData();
          } else {
            showToast(result ? result.message : 'ä¸€æ‹¬å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            updateStatus('ä¸€æ‹¬å‡¦ç†ã‚¨ãƒ©ãƒ¼', 'error');
          }
        })
        .catch(error => {
          console.error('ä¸€æ‹¬å¼•æ¸¡ã‚¨ãƒ©ãƒ¼:', error);
          showToast('ä¸€æ‹¬å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
          updateStatus('ä¸€æ‹¬å‡¦ç†ã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    function bulkReturn() {
      if (selectedOrders.size === 0) {
        showToast('äºˆç´„ã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
        return;
      }
      
      if (!confirm(`é¸æŠã•ã‚ŒãŸ${selectedOrders.size}ä»¶ã®äºˆç´„ã‚’ä¸€æ‹¬ã§ã€Œæœªå¼•æ¸¡ã€ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ`)) {
        return;
      }
      
      updateStatus('ä¸€æ‹¬æˆ»ã—å‡¦ç†ä¸­', 'loading');
      
      const orderIds = Array.from(selectedOrders);
      safeCallGoogleScript('bulkUpdateDeliveryStatus', orderIds, 'æœªå¼•æ¸¡')
        .then(result => {
          if (result && result.success) {
            showToast(`ä¸€æ‹¬å‡¦ç†å®Œäº†: æˆåŠŸ${result.successCount}ä»¶`, 'success');
            updateStatus('ä¸€æ‹¬å‡¦ç†å®Œäº†', 'success');
            
            clearSelection();
            loadOrdersData();
            loadOverviewData();
          } else {
            showToast(result ? result.message : 'ä¸€æ‹¬å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            updateStatus('ä¸€æ‹¬å‡¦ç†ã‚¨ãƒ©ãƒ¼', 'error');
          }
        })
        .catch(error => {
          console.error('ä¸€æ‹¬æˆ»ã—ã‚¨ãƒ©ãƒ¼:', error);
          showToast('ä¸€æ‹¬å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
          updateStatus('ä¸€æ‹¬å‡¦ç†ã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
    function applyOrderFilters() {
      const filterType = document.getElementById('order-status-filter').value;
      const searchTerm = document.getElementById('order-search').value.toLowerCase();
      const dateFilter = document.getElementById('order-date-filter').value;
      
      loadOrdersData();
    }

    // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
    function exportOrdersData() {
      updateStatus('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡¦ç†ä¸­', 'loading');
      
      safeCallGoogleScript('exportOrders')
        .then(result => {
          if (result && result.success) {
            showToast(result.message, 'success');
            updateStatus('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†', 'success');
            // å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã¯çœç•¥
          } else {
            showToast(result ? result.message : 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            updateStatus('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼', 'error');
          }
        })
        .catch(error => {
          console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
          showToast('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
          updateStatus('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    // å®‰å…¨ãªGoogle Scriptå‘¼ã³å‡ºã—
    function safeCallGoogleScript(functionName, ...args) {
      return new Promise((resolve, reject) => {
        try {
          const timeout = setTimeout(() => {
            reject(new Error(`${functionName}: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ`));
          }, 15000);
          
          google.script.run
            .withSuccessHandler(function(result) {
              clearTimeout(timeout);
              resolve(result);
            })
            .withFailureHandler(function(error) {
              clearTimeout(timeout);
              reject(error);
            })
            [functionName](...args);
        } catch (error) {
          reject(error);
        }
      });
    }

    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
    function showLoading(section) {
      const loading = document.getElementById(`${section}-loading`);
      const content = document.getElementById(`${section}-content`);
      if (loading) loading.classList.add('show');
      if (content) content.style.display = 'none';
    }

    function hideLoading(section) {
      const loading = document.getElementById(`${section}-loading`);
      const content = document.getElementById(`${section}-content`);
      if (loading) loading.classList.remove('show');
      if (content) content.style.display = 'block';
    }

    function showError(section, message) {
      const content = document.getElementById(`${section}-content`);
      if (content) {
        content.innerHTML = `
          <div class="alert alert-danger">
            <h6><i class="bi bi-exclamation-triangle me-2"></i>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h6>
            <p class="mb-0">${message}</p>
          </div>
        `;
        content.style.display = 'block';
      }
      hideLoading(section);
    }

    function updateStatus(message, type) {
      const status = document.getElementById('status');
      if (!status) return;
      
      let icon = 'bi-wifi';
      let color = 'rgba(40, 167, 69, 0.9)';
      
      switch (type) {
        case 'loading':
          icon = 'bi-arrow-clockwise';
          color = 'rgba(255, 193, 7, 0.9)';
          break;
        case 'error':
          icon = 'bi-exclamation-triangle';
          color = 'rgba(220, 53, 69, 0.9)';
          break;
        case 'success':
          icon = 'bi-check-circle';
          color = 'rgba(40, 167, 69, 0.9)';
          break;
      }
      
      status.innerHTML = `<i class="${icon}"></i> ${message}`;
      status.style.backgroundColor = color;
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      let bgClass = 'bg-info';
      let iconClass = 'bi-info-circle';
      
      switch (type) {
        case 'success':
          bgClass = 'bg-success';
          iconClass = 'bi-check-circle';
          break;
        case 'error':
          bgClass = 'bg-danger';
          iconClass = 'bi-x-circle';
          break;
        case 'warning':
          bgClass = 'bg-warning';
          iconClass = 'bi-exclamation-triangle';
          break;
      }

      toast.className = `toast align-items-center text-white ${bgClass} border-0`;
      toast.style.cssText = 'position: fixed; top: 100px; right: 20px; z-index: 1100; min-width: 350px;';
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">
            <i class="${iconClass} me-2"></i>${message}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      `;

      document.body.appendChild(toast);
      
      const toastBootstrap = new bootstrap.Toast(toast, {
        autohide: true,
        delay: type === 'error' ? 8000 : 5000
      });
      
      toastBootstrap.show();

      toast.addEventListener('hidden.bs.toast', function() {
        this.remove();
      });
    }

    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºé–¢æ•°
    function showInitError(message) {
      const errorDiv = document.getElementById('init-error');
      const messageDiv = document.getElementById('init-error-message');
      messageDiv.textContent = message;
      errorDiv.classList.add('show');
      updateStatus('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼', 'error');
    }

    function hideInitError() {
      const errorDiv = document.getElementById('init-error');
      errorDiv.classList.remove('show');
    }

    function retryInitialization() {
      retryCount = 0;
      hideInitError();
      attemptDataLoad();
    }

    function useOfflineMode() {
      hideInitError();
      loadOfflineData();
    }

    function loadOfflineData() {
      const offlineStats = {
        todayOrdersCount: '?',
        pendingOrdersCount: '?',
        deliveredOrdersCount: '?',
        outOfStockCount: '?',
        lowStockCount: '?',
        totalProducts: '?',
        todayRevenue: '?',
        monthRevenue: '?',
        systemVersion: '5.3.4',
        lastUpdate: new Date().toISOString()
      };
      
      currentData = { 
        stats: offlineStats, 
        orders: [], 
        inventory: [], 
        products: [] 
      };
      
      renderOverview();
      hideLoading('overview');
      updateStatus('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰', 'error');
    }

    // è‡ªå‹•æ›´æ–°æ©Ÿèƒ½
    function startAutoUpdate() {
      updateInterval = setInterval(() => {
        if (systemInitialized) {
          loadOverviewData();
        }
      }, 60000); // 1åˆ†é–“éš”
    }

    function refreshAllData() {
      clearSelection();
      loadTabData('overview');
      loadTabData('orders');
      loadTabData('inventory');
      showToast('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
    function debugData() {
      updateStatus('ãƒ‡ãƒãƒƒã‚°æƒ…å ±å–å¾—ä¸­', 'loading');
      
      safeCallGoogleScript('debugOrderData')
        .then(result => {
          const debugPanel = document.getElementById('debug-panel');
          const debugContent = document.getElementById('debug-content');
          
          // ğŸ”§ å¼·åŒ–ã•ã‚ŒãŸãƒ‡ãƒãƒƒã‚°è¡¨ç¤º
          let debugHtml = '';
          
          if (result.error) {
            debugHtml = `
              <div class="alert alert-danger">
                <h6>ã‚¨ãƒ©ãƒ¼</h6>
                <pre>${result.error}</pre>
              </div>
            `;
          } else {
            debugHtml = `
              <div class="alert alert-info mb-3">
                <h6><i class="bi bi-info-circle me-2"></i>åŸºæœ¬æƒ…å ±</h6>
                <div class="row">
                  <div class="col-md-6">
                    <strong>ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³:</strong> ${result.systemVersion}<br>
                    <strong>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè¡Œæ•°:</strong> ${result.totalRows}<br>
                    <strong>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆåˆ—æ•°:</strong> ${result.totalColumns}<br>
                    <strong>å‡¦ç†æ¸ˆã¿äºˆç´„æ•°:</strong> <span class="debug-highlight">${result.processedOrders}</span>
                  </div>
                  <div class="col-md-6">
                    <strong>çµ±è¨ˆä»Šæ—¥ã®äºˆç´„:</strong> <span class="debug-highlight">${result.statisticsData?.todayOrdersCount || 0}</span><br>
                    <strong>çµ±è¨ˆæœªå¼•æ¸¡:</strong> ${result.statisticsData?.pendingOrdersCount || 0}<br>
                    <strong>çµ±è¨ˆå¼•æ¸¡æ¸ˆ:</strong> ${result.statisticsData?.deliveredOrdersCount || 0}<br>
                    <strong>ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œæ™‚åˆ»:</strong> ${new Date(result.debugTimestamp).toLocaleString()}
                  </div>
                </div>
              </div>
              
              <div class="alert alert-warning mb-3">
                <h6><i class="bi bi-exclamation-triangle me-2"></i>å•é¡Œåˆ†æ</h6>
                <p><strong>çµ±è¨ˆã§ã¯ã€Œä»Šæ—¥ã®äºˆç´„: ${result.statisticsData?.todayOrdersCount || 0}ã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã®ã«ã€æœ€è¿‘ã®äºˆç´„ä¸€è¦§ãŒç©ºã®å ´åˆ:</strong></p>
                <ul class="mb-0">
                  <li>getOrderList()ã¨çµ±è¨ˆè¨ˆç®—ã§ç•°ãªã‚‹ãƒ­ã‚¸ãƒƒã‚¯ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§</li>
                  <li>å¼•æ¸¡çŠ¶æ³ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§</li>
                  <li>æ—¥ä»˜ã®è§£æå‡¦ç†ã«å·®ç•°ãŒã‚ã‚‹å¯èƒ½æ€§</li>
                </ul>
              </div>

              <div class="accordion" id="debugAccordion">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#deliveryStatus">
                      å¼•æ¸¡çŠ¶æ³åˆ†å¸ƒ
                    </button>
                  </h2>
                  <div id="deliveryStatus" class="accordion-collapse collapse" data-bs-parent="#debugAccordion">
                    <div class="accordion-body">
                      <pre>${JSON.stringify(result.deliveryStatusDistribution || {}, null, 2)}</pre>
                    </div>
                  </div>
                </div>
                
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#columnMapping">
                      åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°ç¢ºèª
                    </button>
                  </h2>
                  <div id="columnMapping" class="accordion-collapse collapse" data-bs-parent="#debugAccordion">
                    <div class="accordion-body">
                      <pre>${JSON.stringify(result.columnMapping || {}, null, 2)}</pre>
                    </div>
                  </div>
                </div>
                
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#productColumns">
                      å•†å“åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°
                    </button>
                  </h2>
                  <div id="productColumns" class="accordion-collapse collapse" data-bs-parent="#debugAccordion">
                    <div class="accordion-body">
                      <pre>${JSON.stringify(result.productColumns || {}, null, 2)}</pre>
                    </div>
                  </div>
                </div>
                
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#fullData">
                      å®Œå…¨ãƒ‡ãƒãƒƒã‚°æƒ…å ±
                    </button>
                  </h2>
                  <div id="fullData" class="accordion-collapse collapse" data-bs-parent="#debugAccordion">
                    <div class="accordion-body">
                      <pre>${JSON.stringify(result, null, 2)}</pre>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }
          
          debugContent.innerHTML = debugHtml;
          debugPanel.style.display = 'block';
          
          updateStatus('ãƒ‡ãƒãƒƒã‚°æƒ…å ±å–å¾—å®Œäº†', 'success');
        })
        .catch(error => {
          console.error('ãƒ‡ãƒãƒƒã‚°æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
          showToast('ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
          updateStatus('ãƒ‡ãƒãƒƒã‚°ã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    function hideDebugPanel() {
      document.getElementById('debug-panel').style.display = 'none';
    }

    function exportData() {
      exportOrdersData();
    }

    function clearSystemCache() {
      updateStatus('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ä¸­', 'loading');
      
      safeCallGoogleScript('clearCache')
        .then(result => {
          if (result && result.success) {
            showToast(result.message, 'success');
            updateStatus('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Œäº†', 'success');
            refreshAllData();
          } else {
            showToast(result ? result.message : 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            updateStatus('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼', 'error');
          }
        })
        .catch(error => {
          console.error('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼:', error);
          showToast('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
          updateStatus('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼', 'error');
        });
    }

    console.log('âœ… Dashboard v5.3.4 - GASæœ€é©åŒ–ç‰ˆ åˆæœŸåŒ–å®Œäº†');
  </script>
</body>
</html>