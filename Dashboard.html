<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hyggely„Ç´„É≥„Éë„Éº„Éã„É•Â∞ÇÈñÄÂ∫ó ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ v5.3.0</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    body {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
    }
    
    /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
    .navbar {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%) !important;
      box-shadow: 0 4px 20px rgba(139, 69, 19, 0.3);
    }
    .navbar-brand { font-weight: bold; color: white !important; }
    .nav-link {
      color: rgba(255, 255, 255, 0.9) !important;
      transition: all 0.3s ease;
      border-radius: 6px;
      margin: 0 3px;
      padding: 8px 12px !important;
    }
    .nav-link:hover {
      color: white !important;
      background: rgba(255, 255, 255, 0.1);
    }
    
    /* „Ç´„Éº„Éâ */
    .card {
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 1.5rem;
      background: rgba(255, 255, 255, 0.95);
      transition: all 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }
    .card-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid rgba(139, 69, 19, 0.1);
      font-weight: 700;
      padding: 1rem 1.5rem;
      border-radius: 12px 12px 0 0;
    }
    .card-body { padding: 1.5rem; }
    
    /* Áµ±Ë®à„Ç´„Éº„Éâ */
    .stat-card {
      transition: all 0.3s ease;
      cursor: pointer;
      height: 100%;
    }
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }
    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0;
    }
    
    /* „Éú„Çø„É≥ */
    .btn-primary {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
      border: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .btn-primary:hover { transform: translateY(-1px); }
    
    /* „ÉÜ„Éº„Éñ„É´ */
    .table { border-radius: 8px; overflow: hidden; }
    .table th {
      background: linear-gradient(135deg, #f8f6f0 0%, #f0ede5 100%);
      font-weight: 700;
      border: none;
      padding: 12px 8px;
      font-size: 0.9rem;
    }
    .table td { 
      padding: 10px 8px; 
      border-color: #f0f0f0; 
      font-size: 0.85rem;
      vertical-align: middle;
    }
    
    /* ‰∫àÁ¥Ñ„ÉÜ„Éº„Éñ„É´„ÅÆÊúÄÈÅ©Âåñ */
    .orders-table {
      font-size: 0.8rem;
    }
    .orders-table .pickup-date {
      font-weight: bold;
      color: #8B4513;
      font-size: 0.9rem;
    }
    .orders-table .pickup-time {
      color: #666;
      font-size: 0.75rem;
    }
    .orders-table .customer-name {
      font-weight: 600;
      color: #333;
    }
    .orders-table .customer-email {
      color: #666;
      font-size: 0.7rem;
    }
    .orders-table .order-id {
      font-family: 'Courier New', monospace;
      font-size: 0.7rem;
      background: #f8f9fa;
      padding: 2px 4px;
      border-radius: 3px;
      color: #495057;
    }
    .orders-table .order-items {
      max-height: 60px;
      overflow-y: auto;
      font-size: 0.75rem;
      line-height: 1.2;
    }
    
    /* „Çø„Éñ */
    .nav-pills .nav-link {
      color: #6c757d;
      border-radius: 8px;
      margin-right: 10px;
      padding: 12px 20px;
      font-weight: 600;
    }
    .nav-pills .nav-link.active {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
    }
    
    /* „É≠„Éº„Éá„Ç£„É≥„Ç∞ */
    .loading {
      display: none;
      text-align: center;
      padding: 3rem;
    }
    .loading.show { display: block; }
    
    /* üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Ç®„É©„ÉºË°®Á§∫ */
    .error-container {
      display: none;
      text-align: center;
      padding: 3rem;
      background: #fff;
      border-radius: 15px;
      margin: 2rem 0;
    }
    .error-container.show { display: block; }
    .error-icon {
      font-size: 4rem;
      color: #dc3545;
      margin-bottom: 1rem;
    }
    
    /* üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Ç™„Éï„É©„Ç§„É≥Ë°®Á§∫ */
    .offline-mode {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      color: #856404;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    /* „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫ */
    .status-indicator {
      position: fixed;
      top: 70px;
      right: 15px;
      z-index: 1000;
      background: rgba(40, 167, 69, 0.9);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }
    
    /* üîß Êñ∞Ë¶èËøΩÂä†ÔºöÊé•Á∂öÁä∂ÊÖãË°®Á§∫ */
    .connection-status {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }
    .connection-status.online {
      background: rgba(40, 167, 69, 0.9);
      color: white;
    }
    .connection-status.offline {
      background: rgba(220, 53, 69, 0.9);
      color: white;
    }
    
    /* „É¢„Éº„ÉÄ„É´ */
    .modal-xl { max-width: 90%; }
    .modal-header {
      background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
      color: white;
    }
    
    /* „Éê„ÉÉ„Ç∏ */
    .stock-ok { background-color: #28a745; }
    .stock-low { background-color: #ffc107; color: #000; }
    .stock-out { background-color: #dc3545; }
    
    /* „Éï„Ç©„Éº„É† */
    .form-control, .form-select {
      border-radius: 8px;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }
    .form-control:focus, .form-select:focus {
      border-color: #8B4513;
      box-shadow: 0 0 0 0.2rem rgba(139, 69, 19, 0.15);
    }
    
    /* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */
    .action-buttons {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }
    .action-buttons .btn {
      padding: 4px 8px;
      font-size: 0.75rem;
      border-radius: 4px;
    }
    
    /* üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Çπ„Ç±„É´„Éà„É≥„É≠„Éº„Éá„Ç£„É≥„Ç∞ */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.2s infinite linear;
      border-radius: 6px;
      height: 20px;
      margin-bottom: 8px;
    }
    .skeleton-title { width: 60%; height: 24px; }
    .skeleton-text { width: 80%; height: 16px; }
    .skeleton-number { width: 40%; height: 32px; }
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±Ë°®Á§∫ */
    .debug-info {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      font-family: 'Courier New', monospace;
      font-size: 0.8rem;
      max-height: 400px;
      overflow-y: auto;
    }
    
    /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÊúÄÈÅ©Âåñ */
    @media (max-width: 768px) {
      .container-fluid { padding: 0.5rem; }
      .card { margin-bottom: 1rem; }
      .card-body { padding: 1rem; }
      .stat-number { font-size: 1.5rem; }
      .table th, .table td {
        padding: 6px 4px;
        font-size: 0.8rem;
      }
      .navbar-brand { font-size: 1rem; }
      .nav-link { padding: 6px 8px !important; }
      .action-buttons {
        flex-direction: column;
        align-items: stretch;
      }
      .action-buttons .btn {
        margin-bottom: 2px;
      }
      .orders-table .order-items {
        max-height: 40px;
      }
    }
    
    /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.05); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* „Ç´„Çπ„Çø„É†Ë¶ÅÁ¥† */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .quick-stat {
      text-align: center;
      padding: 1rem;
      background: white;
      border-radius: 8px;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }
    
    .quick-stat:hover {
      border-color: #8B4513;
      box-shadow: 0 4px 15px rgba(139, 69, 19, 0.1);
    }
    
    /* üîß Êñ∞Ë¶èËøΩÂä†Ôºö„É™„Éà„É©„Ç§„Éú„Çø„É≥ */
    .retry-section {
      text-align: center;
      padding: 2rem;
      background: white;
      border-radius: 15px;
      margin: 2rem 0;
    }
    
    /* üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Éê„Éº„Ç∏„Éß„É≥Ë°®Á§∫ */
    .version-info {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
    }
  </style>
</head>
<body>
  <!-- üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Éê„Éº„Ç∏„Éß„É≥Ë°®Á§∫ -->
  <div class="version-info">v5.3.0</div>
  
  <!-- „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫ -->
  <div class="status-indicator pulse" id="status">
    <i class="bi bi-wifi"></i> Êé•Á∂ö‰∏≠
  </div>
  
  <!-- üîß Êñ∞Ë¶èËøΩÂä†ÔºöÊé•Á∂öÁä∂ÊÖãË°®Á§∫ -->
  <div class="connection-status online" id="connection-status">
    <i class="bi bi-wifi"></i> „Ç™„É≥„É©„Ç§„É≥
  </div>

  <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <i class="bi bi-shop me-2"></i>HyggelyÁÆ°ÁêÜ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ v5.3.0
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="?" target="_blank">
            <i class="bi bi-box-arrow-up-right me-1"></i>‰∫àÁ¥Ñ„Éï„Ç©„Éº„É†
          </a>
          <a class="nav-link" href="?action=email&password=hyggelyAdmin2024" target="_blank">
            <i class="bi bi-envelope-gear me-1"></i>„É°„Éº„É´Ë®≠ÂÆö
          </a>
          <a class="nav-link" href="#" onclick="refreshAllData()">
            <i class="bi bi-arrow-clockwise me-1"></i>Êõ¥Êñ∞
          </a>
          <a class="nav-link" href="#" onclick="debugData()">
            <i class="bi bi-bug me-1"></i>„Éá„Éê„ÉÉ„Ç∞
          </a>
          <a class="nav-link" href="#" onclick="exportData()">
            <i class="bi bi-download me-1"></i>„Ç®„ÇØ„Çπ„Éù„Éº„Éà
          </a>
          <a class="nav-link" href="#" onclick="clearSystemCache()">
            <i class="bi bi-trash me-1"></i>„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid py-3">
    <!-- üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„ÉâË°®Á§∫ -->
    <div class="offline-mode" id="offline-mode" style="display: none;">
      <i class="bi bi-wifi-off me-2"></i>
      <strong>„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ</strong> - ‰∏ÄÈÉ®„ÅÆÊ©üËÉΩ„ÅåÂà∂Èôê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊé•Á∂ö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
    </div>

    <!-- üîß Êñ∞Ë¶èËøΩÂä†ÔºöÂàùÊúüÂåñ„Ç®„É©„ÉºË°®Á§∫ -->
    <div class="error-container" id="init-error">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h3>ÂàùÊúüÂåñ„Ç®„É©„Éº</h3>
      <p id="init-error-message">Google Apps Script„Å®„ÅÆÊé•Á∂ö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ</p>
      <div class="retry-section">
        <button class="btn btn-primary me-2" onclick="retryInitialization()">
          <i class="bi bi-arrow-clockwise me-1"></i>ÂÜçË©¶Ë°å
        </button>
        <button class="btn btn-outline-secondary" onclick="useOfflineMode()">
          <i class="bi bi-wifi-off me-1"></i>„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ„ÅßÁ∂öË°å
        </button>
      </div>
    </div>

    <!-- üîß ‰øÆÊ≠£ÁâàÔºö„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„Éë„Éç„É´ -->
    <div class="card mb-3" id="debug-panel" style="display: none;">
      <div class="card-header">
        <i class="bi bi-bug me-2"></i>„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†± v5.3.0
        <button class="btn btn-sm btn-outline-secondary float-end" onclick="hideDebugPanel()">
          <i class="bi bi-x"></i> Èñâ„Åò„Çã
        </button>
      </div>
      <div class="card-body">
        <div id="debug-content" class="debug-info">
          „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíË™≠„ÅøËæº„Åø‰∏≠...
        </div>
      </div>
    </div>

    <!-- „Çø„Éñ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
    <ul class="nav nav-pills mb-3" id="dashboardTabs">
      <li class="nav-item">
        <button class="nav-link active" id="overview-tab" data-bs-toggle="pill" data-bs-target="#overview">
          <i class="bi bi-house-door me-1"></i>Ê¶ÇË¶Å
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="orders-tab" data-bs-toggle="pill" data-bs-target="#orders">
          <i class="bi bi-list-check me-1"></i>‰∫àÁ¥ÑÁÆ°ÁêÜ
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="inventory-tab" data-bs-toggle="pill" data-bs-target="#inventory">
          <i class="bi bi-box-seam me-1"></i>Âú®Â∫´ÁÆ°ÁêÜ
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="menu-tab" data-bs-toggle="pill" data-bs-target="#menu">
          <i class="bi bi-menu-button-wide me-1"></i>„É°„Éã„É•„ÉºÁÆ°ÁêÜ
        </button>
      </li>
    </ul>

    <!-- „Çø„Éñ„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="tab-content" id="dashboardTabContent">
      <!-- Ê¶ÇË¶Å„Çø„Éñ -->
      <div class="tab-pane fade show active" id="overview">
        <div class="loading" id="overview-loading">
          <div class="spinner-border" style="color: #8B4513;"></div>
          <p class="mt-3">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</p>
        </div>

        <div id="overview-content" style="display: none;">
          <!-- Áµ±Ë®à„Ç´„Éº„ÉâÔºà„Çπ„Ç±„É´„Éà„É≥ÂØæÂøúÔºâ -->
          <div class="quick-stats mb-4" id="stats-container">
            <!-- „Çπ„Ç±„É´„Éà„É≥„É≠„Éº„Éá„Ç£„É≥„Ç∞ -->
            <div class="quick-stat skeleton-stat">
              <div class="skeleton skeleton-number"></div>
              <div class="skeleton skeleton-text"></div>
            </div>
            <div class="quick-stat skeleton-stat">
              <div class="skeleton skeleton-number"></div>
              <div class="skeleton skeleton-text"></div>
            </div>
            <div class="quick-stat skeleton-stat">
              <div class="skeleton skeleton-number"></div>
              <div class="skeleton skeleton-text"></div>
            </div>
            <div class="quick-stat skeleton-stat">
              <div class="skeleton skeleton-number"></div>
              <div class="skeleton skeleton-text"></div>
            </div>
            <div class="quick-stat skeleton-stat">
              <div class="skeleton skeleton-number"></div>
              <div class="skeleton skeleton-text"></div>
            </div>
            <div class="quick-stat skeleton-stat">
              <div class="skeleton skeleton-number"></div>
              <div class="skeleton skeleton-text"></div>
            </div>
          </div>

          <!-- ‰ªäÂæå1ÈÄ±Èñì„ÅÆ‰∫àÁ¥ÑÁä∂Ê≥Å -->
          <div class="card mb-4">
            <div class="card-header">
              <i class="bi bi-calendar-week me-2"></i>‰ªäÂæå1ÈÄ±Èñì„ÅÆ‰∫àÁ¥ÑÁä∂Ê≥Å
            </div>
            <div class="card-body" id="week-reservations">
              <div class="text-center text-muted">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
            </div>
          </div>

          <!-- Âú®Â∫´„Ç¢„É©„Éº„Éà -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <span><i class="bi bi-exclamation-triangle text-danger me-2"></i>Âú®Â∫´„Ç¢„É©„Éº„Éà</span>
                  <button class="btn btn-sm btn-outline-primary" onclick="loadOverviewData()">
                    <i class="bi bi-arrow-clockwise"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div id="stock-alerts">
                    <div class="text-center text-muted">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ÊúÄËøë„ÅÆ‰∫àÁ¥Ñ -->
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <i class="bi bi-clock-history me-2"></i>ÊúÄËøë„ÅÆ‰∫àÁ¥ÑÔºàÂèóÂèñÊó•ÊôÇÊòáÈ†Ü„ÉªÁõ¥Ëøë10‰ª∂Ôºâ
                </div>
                <div class="card-body">
                  <div id="recent-orders">
                    <div class="text-center text-muted">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ‰∫àÁ¥ÑÁÆ°ÁêÜ„Çø„Éñ -->
      <div class="tab-pane fade" id="orders">
        <div class="loading" id="orders-loading">
          <div class="spinner-border" style="color: #8B4513;"></div>
          <p class="mt-3">‰∫àÁ¥Ñ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</p>
        </div>

        <div id="orders-content" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span><i class="bi bi-list-check me-2"></i>‰∫àÁ¥Ñ‰∏ÄË¶ßÁÆ°ÁêÜÔºàÂèóÂèñÊó•ÊôÇÊòáÈ†ÜÔºâ</span>
              <div>
                <button class="btn btn-sm btn-success me-2" onclick="exportOrders()">
                  <i class="bi bi-download me-1"></i>„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                </button>
                <button class="btn btn-sm btn-outline-primary" onclick="loadOrdersData()">
                  <i class="bi bi-arrow-clockwise me-1"></i>Êõ¥Êñ∞
                </button>
              </div>
            </div>
            <div class="card-body">
              <!-- „Éï„Ç£„É´„Çø„Éº -->
              <div class="row mb-3">
                <div class="col-md-3">
                  <select class="form-select" id="order-status-filter">
                    <option value="">ÂÖ®„Å¶„ÅÆÁä∂ÊÖã</option>
                    <option value="pending">Êú™ÂºïÊ∏°</option>
                    <option value="delivered">ÂºïÊ∏°Ê∏à</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <input type="date" class="form-control" id="order-date-filter">
                </div>
                <div class="col-md-4">
                  <input type="text" class="form-control" id="order-search" placeholder="È°ßÂÆ¢Âêç„Éª„É°„Éº„É´„ÅßÊ§úÁ¥¢">
                </div>
                <div class="col-md-2">
                  <button class="btn btn-primary w-100" onclick="applyOrderFilters()">
                    <i class="bi bi-search"></i> Ê§úÁ¥¢
                  </button>
                </div>
              </div>
              
              <div class="table-responsive">
                <table class="table table-hover orders-table">
                  <thead>
                    <tr>
                      <th>ÂèóÂèñÊó•ÊôÇ</th>
                      <th>„ÅäÂÆ¢Êßò</th>
                      <th>ÂïÜÂìÅ</th>
                      <th>ÈáëÈ°ç</th>
                      <th>Áä∂ÊÖã</th>
                      <th>‰∫àÁ¥ÑID</th>
                      <th>Êìç‰Ωú</th>
                    </tr>
                  </thead>
                  <tbody id="orders-table-body">
                    <tr><td colspan="7" class="text-center">Ë™≠„ÅøËæº„Åø‰∏≠...</td></tr>
                  </tbody>
                </table>
              </div>
              
              <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
              <nav aria-label="‰∫àÁ¥Ñ‰∏ÄË¶ß„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥">
                <ul class="pagination justify-content-center" id="orders-pagination">
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <!-- Âú®Â∫´ÁÆ°ÁêÜ„Çø„Éñ -->
      <div class="tab-pane fade" id="inventory">
        <div class="loading" id="inventory-loading">
          <div class="spinner-border" style="color: #8B4513;"></div>
          <p class="mt-3">Âú®Â∫´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</p>
        </div>

        <div id="inventory-content" style="display: none;">
          <!-- ‰∏ÄÊã¨Êìç‰Ωú„Éë„Éç„É´ -->
          <div class="card mb-4">
            <div class="card-header">
              <i class="bi bi-gear me-2"></i>‰∏ÄÊã¨Êìç‰Ωú
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <button class="btn btn-warning w-100" onclick="showBulkUpdateModal()">
                    <i class="bi bi-pencil-square me-1"></i>‰∏ÄÊã¨Âú®Â∫´Êõ¥Êñ∞
                  </button>
                </div>
                <div class="col-md-4">
                  <button class="btn btn-info w-100" onclick="resetAllInventory()">
                    <i class="bi bi-arrow-clockwise me-1"></i>Âú®Â∫´„É™„Çª„ÉÉ„Éà
                  </button>
                </div>
                <div class="col-md-4">
                  <button class="btn btn-success w-100" onclick="exportInventory()">
                    <i class="bi bi-download me-1"></i>Âú®Â∫´„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Âú®Â∫´‰∏ÄË¶ß -->
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span><i class="bi bi-box-seam me-2"></i>Âú®Â∫´ÁÆ°ÁêÜ</span>
              <button class="btn btn-sm btn-outline-primary" onclick="loadInventoryData()">
                <i class="bi bi-arrow-clockwise me-1"></i>Êõ¥Êñ∞
              </button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ÂïÜÂìÅÂêç</th>
                      <th>Âçò‰æ°</th>
                      <th>Âú®Â∫´Êï∞</th>
                      <th>‰∫àÁ¥ÑÊï∞</th>
                      <th>ÊÆãÊï∞</th>
                      <th>ÊúÄ‰ΩéÂú®Â∫´</th>
                      <th>Áä∂ÊÖã</th>
                      <th>Êìç‰Ωú</th>
                    </tr>
                  </thead>
                  <tbody id="inventory-table-body">
                    <tr><td colspan="8" class="text-center text-muted py-4">Âú®Â∫´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- „É°„Éã„É•„ÉºÁÆ°ÁêÜ„Çø„Éñ -->
      <div class="tab-pane fade" id="menu">
        <div class="loading" id="menu-loading">
          <div class="spinner-border" style="color: #8B4513;"></div>
          <p class="mt-3">„É°„Éã„É•„Éº„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</p>
        </div>

        <div id="menu-content" style="display: none;">
          <!-- Êñ∞ÂïÜÂìÅËøΩÂä†„Éë„Éç„É´ -->
          <div class="card mb-4">
            <div class="card-header">
              <i class="bi bi-plus-circle me-2"></i>Êñ∞ÂïÜÂìÅËøΩÂä†
            </div>
            <div class="card-body">
              <form id="add-product-form" class="product-form">
                <div class="row">
                  <div class="col-md-4">
                    <label class="form-label">ÂïÜÂìÅÂêç <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="new-product-name" required>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">‰æ°Ê†º <span class="text-danger">*</span></label>
                    <input type="number" class="form-control" id="new-product-price" min="0" required>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Ë°®Á§∫È†Ü</label>
                    <input type="number" class="form-control" id="new-product-order" min="1">
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">ÂàùÊúüÂú®Â∫´</label>
                    <input type="number" class="form-control" id="new-product-stock" min="0" value="10">
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <button type="button" class="btn btn-primary w-100" onclick="addNewProduct()">
                      <i class="bi bi-plus me-1"></i>ËøΩÂä†
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
          
          <!-- „É°„Éã„É•„Éº‰∏ÄË¶ß -->
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span><i class="bi bi-menu-button-wide me-2"></i>ÂïÜÂìÅ„É°„Éã„É•„ÉºÁÆ°ÁêÜ</span>
              <button class="btn btn-sm btn-outline-primary" onclick="loadMenuData()">
                <i class="bi bi-arrow-clockwise me-1"></i>Êõ¥Êñ∞
              </button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Ë°®Á§∫È†Ü</th>
                      <th>ÂïÜÂìÅID</th>
                      <th>ÂïÜÂìÅÂêç</th>
                      <th>‰æ°Ê†º</th>
                      <th>Áä∂ÊÖã</th>
                      <th>‰ΩúÊàêÊó•</th>
                      <th>Êìç‰Ωú</th>
                    </tr>
                  </thead>
                  <tbody id="menu-table-body">
                    <tr><td colspan="7" class="text-center text-muted py-4">„É°„Éã„É•„Éº„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- üîß Êó¢Â≠ò„ÅÆ„É¢„Éº„ÉÄ„É´ÔºàÂ§âÊõ¥„Å™„ÅóÔºâ -->
  <!-- ‰∫àÁ¥ÑË©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
  <div class="modal fade" id="orderDetailModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">‰∫àÁ¥ÑË©≥Á¥∞</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="order-detail-content">
            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Èñâ„Åò„Çã</button>
          <button type="button" class="btn btn-warning" id="edit-order-btn">Á∑®ÈõÜ</button>
          <button type="button" class="btn btn-danger" id="cancel-order-btn">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ÈÄ±Èñì‰∫àÁ¥ÑË©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
  <div class="modal fade" id="weekDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="weekDetailModalTitle">‰∫àÁ¥ÑË©≥Á¥∞</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="week-detail-content">
            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Èñâ„Åò„Çã</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Âú®Â∫´Êõ¥Êñ∞„É¢„Éº„ÉÄ„É´ -->
  <div class="modal fade" id="stockModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Âú®Â∫´Êï∞Êõ¥Êñ∞</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="stock-form">
            <input type="hidden" id="stock-product-id">
            <div class="mb-3">
              <label class="form-label">ÂïÜÂìÅÂêç</label>
              <input type="text" class="form-control" id="stock-product-name" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">ÁèæÂú®„ÅÆÂú®Â∫´Êï∞</label>
              <input type="number" class="form-control" id="stock-current" readonly>
            </div>
            <div class="mb-3">
              <label class="form-label">Êñ∞„Åó„ÅÑÂú®Â∫´Êï∞</label>
              <input type="number" class="form-control" id="stock-new" min="0" required>
            </div>
            <div class="mb-3">
              <label class="form-label">ÊúÄ‰ΩéÂú®Â∫´Êï∞</label>
              <input type="number" class="form-control" id="stock-min" min="0" value="3">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">„Ç≠„É£„É≥„Çª„É´</button>
          <button type="button" class="btn btn-primary" onclick="updateStock()">Êõ¥Êñ∞</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‰∏ÄÊã¨Âú®Â∫´Êõ¥Êñ∞„É¢„Éº„ÉÄ„É´ -->
  <div class="modal fade" id="bulkUpdateModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">‰∏ÄÊã¨Âú®Â∫´Êõ¥Êñ∞</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            Ë§áÊï∞ÂïÜÂìÅ„ÅÆÂú®Â∫´„Çí‰∏ÄÂ∫¶„Å´Êõ¥Êñ∞„Åß„Åç„Åæ„Åô„ÄÇÂ§âÊõ¥„Åó„Åü„ÅÑÂïÜÂìÅ„ÅÆ„ÅøÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          </div>
          <div id="bulk-update-content">
            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">„Ç≠„É£„É≥„Çª„É´</button>
          <button type="button" class="btn btn-primary" onclick="executeBulkUpdate()">‰∏ÄÊã¨Êõ¥Êñ∞</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ÂïÜÂìÅÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
  <div class="modal fade" id="editProductModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ÂïÜÂìÅÁ∑®ÈõÜ</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="edit-product-form">
            <input type="hidden" id="edit-product-id">
            <div class="mb-3">
              <label class="form-label">ÂïÜÂìÅÂêç <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="edit-product-name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">‰æ°Ê†º <span class="text-danger">*</span></label>
              <input type="number" class="form-control" id="edit-product-price" min="0" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Ë°®Á§∫È†Ü</label>
              <input type="number" class="form-control" id="edit-product-order" min="1">
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="edit-product-enabled">
                <label class="form-check-label" for="edit-product-enabled">
                  ÂïÜÂìÅ„ÇíÊúâÂäπ„Å´„Åô„Çã
                </label>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">„Ç≠„É£„É≥„Çª„É´</button>
          <button type="button" class="btn btn-primary" onclick="saveProductEdit()">‰øùÂ≠ò</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // üîß „Ç∞„É≠„Éº„Éê„É´Áä∂ÊÖãÁÆ°ÁêÜÔºàÊîπËâØÁâàÔºâ
    let currentData = { stats: {}, orders: [], inventory: [], products: [] };
    let updateInterval;
    let currentOrderPage = 1;
    const ordersPerPage = 20;
    let isOnline = true;
    let systemInitialized = false;
    let retryCount = 0;
    const maxRetries = 3;

    // üîß ÂàùÊúüÂåñÔºàÂÆåÂÖ®‰øÆÊ≠£ÁâàÔºâ
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ ÁÆ°ÁêÜËÄÖ„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâËµ∑Âãï v5.3.0 - ÂÆåÂÖ®‰øÆÊ≠£Áâà');
      
      // Êé•Á∂öÁä∂ÊÖãÁõ£Ë¶ñ
      initializeConnectionMonitor();
      
      // „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
      initializeSystem();
      
      // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
      setupEventListeners();
      
      // ÂàùÊúü„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøË©¶Ë°å
      attemptDataLoad();
    });

    // üîß Êñ∞Ë¶èËøΩÂä†ÔºöÊé•Á∂öÁä∂ÊÖãÁõ£Ë¶ñ
    function initializeConnectionMonitor() {
      const connectionStatus = document.getElementById('connection-status');
      
      // „Ç™„É≥„É©„Ç§„É≥/„Ç™„Éï„É©„Ç§„É≥Ê§úÂá∫
      window.addEventListener('online', function() {
        isOnline = true;
        connectionStatus.className = 'connection-status online';
        connectionStatus.innerHTML = '<i class="bi bi-wifi"></i> „Ç™„É≥„É©„Ç§„É≥';
        hideOfflineMode();
        if (!systemInitialized) {
          attemptDataLoad();
        }
      });
      
      window.addEventListener('offline', function() {
        isOnline = false;
        connectionStatus.className = 'connection-status offline';
        connectionStatus.innerHTML = '<i class="bi bi-wifi-off"></i> „Ç™„Éï„É©„Ç§„É≥';
        showOfflineMode();
      });
    }

    // üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
    function initializeSystem() {
      try {
        // Google Apps ScriptÁí∞Â¢É„ÉÅ„Çß„ÉÉ„ÇØ
        if (typeof google === 'undefined' || !google.script || !google.script.run) {
          console.warn('‚ö†Ô∏è Google Apps ScriptÁí∞Â¢É„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åõ„Çì„Åß„Åó„Åü');
          throw new Error('Google Apps ScriptÁí∞Â¢É„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
        }
        
        console.log('‚úÖ Google Apps ScriptÁí∞Â¢É„ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„Åü');
        return true;
      } catch (error) {
        console.error('‚ùå „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
        return false;
      }
    }

    // üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøË©¶Ë°å
    function attemptDataLoad() {
      if (!isOnline) {
        showOfflineMode();
        return;
      }
      
      if (retryCount >= maxRetries) {
        showInitError('ÊúÄÂ§ßË©¶Ë°åÂõûÊï∞„Å´Âà∞ÈÅî„Åó„Åæ„Åó„Åü„ÄÇ„Ç∑„Çπ„ÉÜ„É†ÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ');
        return;
      }
      
      retryCount++;
      updateStatus(`ÂàùÊúüÂåñË©¶Ë°å ${retryCount}/${maxRetries}`, 'loading');
      
      // Google Apps ScriptÊé•Á∂ö„ÉÜ„Çπ„Éà
      setTimeout(() => {
        testGoogleScriptConnection()
          .then(() => {
            console.log('‚úÖ Google Apps ScriptÊé•Á∂öÊàêÂäü');
            systemInitialized = true;
            hideInitError();
            loadTabData('overview');
            startAutoUpdate();
            updateStatus('„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâËµ∑ÂãïÂÆå‰∫Ü', 'success');
          })
          .catch(error => {
            console.error('‚ùå Google Apps ScriptÊé•Á∂öÂ§±Êïó:', error);
            if (retryCount < maxRetries) {
              updateStatus(`Êé•Á∂öÂ§±Êïó„ÄÅÂÜçË©¶Ë°å‰∏≠... (${retryCount}/${maxRetries})`, 'loading');
              setTimeout(() => attemptDataLoad(), 2000 * retryCount); // ÊÆµÈöéÁöÑÈÅÖÂª∂
            } else {
              showInitError('Google Apps Script„Å®„ÅÆÊé•Á∂ö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÊõ¥Êñ∞„Åó„Å¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
          });
      }, 1000);
    }

    // üîß Êñ∞Ë¶èËøΩÂä†ÔºöGoogle Apps ScriptÊé•Á∂ö„ÉÜ„Çπ„Éà
    function testGoogleScriptConnection() {
      return new Promise((resolve, reject) => {
        try {
          // „Çø„Ç§„É†„Ç¢„Ç¶„ÉàË®≠ÂÆö
          const timeout = setTimeout(() => {
            reject(new Error('Êé•Á∂ö„Çø„Ç§„É†„Ç¢„Ç¶„Éà'));
          }, 10000);
          
          google.script.run
            .withSuccessHandler(function(result) {
              clearTimeout(timeout);
              resolve(result);
            })
            .withFailureHandler(function(error) {
              clearTimeout(timeout);
              reject(error);
            })
            .testConnection();
        } catch (error) {
          reject(error);
        }
      });
    }

    // üîß Êñ∞Ë¶èËøΩÂä†ÔºöÂàùÊúüÂåñ„Ç®„É©„ÉºË°®Á§∫
    function showInitError(message) {
      const errorDiv = document.getElementById('init-error');
      const messageDiv = document.getElementById('init-error-message');
      messageDiv.textContent = message;
      errorDiv.classList.add('show');
      updateStatus('ÂàùÊúüÂåñ„Ç®„É©„Éº', 'error');
    }

    function hideInitError() {
      const errorDiv = document.getElementById('init-error');
      errorDiv.classList.remove('show');
    }

    function retryInitialization() {
      retryCount = 0;
      hideInitError();
      attemptDataLoad();
    }

    function useOfflineMode() {
      hideInitError();
      showOfflineMode();
      loadOfflineData();
    }

    // üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ
    function showOfflineMode() {
      const offlineDiv = document.getElementById('offline-mode');
      offlineDiv.style.display = 'block';
    }

    function hideOfflineMode() {
      const offlineDiv = document.getElementById('offline-mode');
      offlineDiv.style.display = 'none';
    }

    function loadOfflineData() {
      // „Ç™„Éï„É©„Ç§„É≥Áî®„ÅÆ„ÉÄ„Éü„Éº„Éá„Éº„Çø
      const offlineStats = {
        todayOrdersCount: '?',
        pendingOrdersCount: '?',
        outOfStockCount: '?',
        lowStockCount: '?',
        totalProducts: '?',
        todayRevenue: '?',
        monthRevenue: '?',
        systemVersion: '5.3.0',
        lastUpdate: new Date().toISOString()
      };
      
      currentData = { 
        stats: offlineStats, 
        orders: [], 
        inventory: [], 
        products: [] 
      };
      
      renderOverview();
      hideLoading('overview');
      updateStatus('„Ç™„Éï„É©„Ç§„É≥„É¢„Éº„Éâ', 'error');
    }

    // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
    function setupEventListeners() {
      // „Çø„ÉñÂàá„ÇäÊõø„Åà„Ç§„Éô„É≥„Éà
      document.querySelectorAll('[data-bs-toggle="pill"]').forEach(tab => {
        tab.addEventListener('shown.bs.tab', function(event) {
          const targetId = event.target.getAttribute('data-bs-target').substring(1);
          if (systemInitialized) {
            loadTabData(targetId);
          }
        });
      });
    }

    // „Çø„Éñ„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Âº∑ÂåñÔºâ
    function loadTabData(tabId) {
      if (!systemInitialized) {
        console.log('‚ö†Ô∏è „Ç∑„Çπ„ÉÜ„É†Êú™ÂàùÊúüÂåñ„ÅÆ„Åü„ÇÅ„ÄÅ„Çø„Éñ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
        return;
      }
      
      switch(tabId) {
        case 'overview': 
          loadOverviewData(); 
          break;
        case 'orders': 
          loadOrdersData(); 
          break;
        case 'inventory': 
          loadInventoryData(); 
          break;
        case 'menu': 
          loadMenuData(); 
          break;
      }
    }

    // üîß ‰øÆÊ≠£ÁâàÔºöÊ¶ÇË¶Å„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Âº∑ÂåñÔºâ
    function loadOverviewData() {
      showLoading('overview');
      updateStatus('Áµ±Ë®à„Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠', 'loading');
      
      // „Çπ„Ç±„É´„Éà„É≥„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
      showSkeletonStats();
      
      Promise.all([
        safeCallGoogleScript('getDashboardStats'),
        safeCallGoogleScript('getInventoryDataForForm'),
        safeCallGoogleScript('getOrderList')
      ]).then(([stats, inventory, orders]) => {
        console.log('üìä ÂèñÂæó„Éá„Éº„Çø:', { 
          stats: stats, 
          inventoryCount: inventory?.length || 0, 
          ordersCount: orders?.length || 0 
        });
        
        currentData = { 
          stats: stats || {}, 
          inventory: inventory || [], 
          orders: orders || [] 
        };
        
        renderOverview();
        hideLoading('overview');
        updateStatus('Êõ¥Êñ∞ÂÆå‰∫Ü', 'success');
      }).catch(error => {
        console.error('Ê¶ÇË¶Å„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
        showError('overview', 'Áµ±Ë®à„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error);
        updateStatus('ÂèñÂæó„Ç®„É©„Éº', 'error');
      });
    }

    // üîß Êñ∞Ë¶èËøΩÂä†ÔºöÂÆâÂÖ®„Å™Google ScriptÂëº„Å≥Âá∫„Åó
    function safeCallGoogleScript(functionName, ...args) {
      return new Promise((resolve, reject) => {
        try {
          const timeout = setTimeout(() => {
            reject(new Error(`${functionName}: „Çø„Ç§„É†„Ç¢„Ç¶„Éà`));
          }, 15000); // 15Áßí„Çø„Ç§„É†„Ç¢„Ç¶„Éà
          
          google.script.run
            .withSuccessHandler(function(result) {
              clearTimeout(timeout);
              resolve(result);
            })
            .withFailureHandler(function(error) {
              clearTimeout(timeout);
              reject(error);
            })
            [functionName](...args);
        } catch (error) {
          reject(error);
        }
      });
    }

    // üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Çπ„Ç±„É´„Éà„É≥„É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
    function showSkeletonStats() {
      const container = document.getElementById('stats-container');
      container.innerHTML = `
        <div class="quick-stat border-primary">
          <div class="skeleton skeleton-number"></div>
          <p class="mb-0 fw-semibold">‰ªäÊó•„ÅÆ‰∫àÁ¥Ñ</p>
        </div>
        <div class="quick-stat border-warning">
          <div class="skeleton skeleton-number"></div>
          <p class="mb-0 fw-semibold">Êú™ÂºïÊ∏°</p>
        </div>
        <div class="quick-stat border-success">
          <div class="skeleton skeleton-number"></div>
          <p class="mb-0 fw-semibold">‰ªäÊúà„ÅÆÂ£≤‰∏ä</p>
        </div>
        <div class="quick-stat border-info">
          <div class="skeleton skeleton-number"></div>
          <p class="mb-0 fw-semibold">‰ªäÊó•„ÅÆÂ£≤‰∏ä</p>
        </div>
        <div class="quick-stat border-danger">
          <div class="skeleton skeleton-number"></div>
          <p class="mb-0 fw-semibold">Âú®Â∫´„Ç¢„É©„Éº„Éà</p>
        </div>
        <div class="quick-stat border-secondary">
          <div class="skeleton skeleton-number"></div>
          <p class="mb-0 fw-semibold">ÂïÜÂìÅÊï∞</p>
        </div>
      `;
    }

    // Ê¶ÇË¶ÅË°®Á§∫Ôºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ËøΩÂä†Ôºâ
    function renderOverview() {
      const stats = currentData.stats;
      const inventory = currentData.inventory;
      const orders = currentData.orders;

      console.log('üìä Áµ±Ë®à„Éá„Éº„ÇøË°®Á§∫:', stats);

      // Áµ±Ë®àË°®Á§∫Ôºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰ªò„ÅçÔºâ
      const container = document.getElementById('stats-container');
      container.innerHTML = `
        <div class="quick-stat border-primary fade-in">
          <i class="bi bi-calendar-check text-primary" style="font-size: 2rem;"></i>
          <p class="stat-number text-primary">${stats.todayOrdersCount || 0}</p>
          <p class="mb-0 fw-semibold">‰ªäÊó•„ÅÆ‰∫àÁ¥Ñ</p>
        </div>
        <div class="quick-stat border-warning fade-in">
          <i class="bi bi-clock text-warning" style="font-size: 2rem;"></i>
          <p class="stat-number text-warning">${stats.pendingOrdersCount || 0}</p>
          <p class="mb-0 fw-semibold">Êú™ÂºïÊ∏°</p>
        </div>
        <div class="quick-stat border-success fade-in">
          <i class="bi bi-currency-yen text-success" style="font-size: 2rem;"></i>
          <p class="stat-number text-success">¬•${(stats.monthRevenue || 0).toLocaleString()}</p>
          <p class="mb-0 fw-semibold">‰ªäÊúà„ÅÆÂ£≤‰∏ä</p>
        </div>
        <div class="quick-stat border-info fade-in">
          <i class="bi bi-cash text-info" style="font-size: 2rem;"></i>
          <p class="stat-number text-info">¬•${(stats.todayRevenue || 0).toLocaleString()}</p>
          <p class="mb-0 fw-semibold">‰ªäÊó•„ÅÆÂ£≤‰∏ä</p>
        </div>
        <div class="quick-stat border-danger fade-in">
          <i class="bi bi-exclamation-triangle text-danger" style="font-size: 2rem;"></i>
          <p class="stat-number text-danger">${(stats.outOfStockCount || 0) + (stats.lowStockCount || 0)}</p>
          <p class="mb-0 fw-semibold">Âú®Â∫´„Ç¢„É©„Éº„Éà</p>
        </div>
        <div class="quick-stat border-secondary fade-in">
          <i class="bi bi-graph-up text-secondary" style="font-size: 2rem;"></i>
          <p class="stat-number text-secondary">${stats.totalProducts || 0}</p>
          <p class="mb-0 fw-semibold">ÂïÜÂìÅÊï∞</p>
        </div>
      `;

      // Âú®Â∫´„Ç¢„É©„Éº„Éà
      renderStockAlerts(inventory);
      
      // ‰ªäÂæå1ÈÄ±Èñì„ÅÆ‰∫àÁ¥ÑÁä∂Ê≥Å
      renderWeekReservations();
      
      // ÊúÄËøë„ÅÆ‰∫àÁ¥ÑÔºàÂèóÂèñÊó•ÊôÇÊòáÈ†Ü„ÅßÊúÄÂàù„ÅÆ10‰ª∂Ôºâ
      renderRecentOrders(orders.slice(0, 10));
    }

    // üîß ‰øÆÊ≠£ÁâàÔºö„Éá„Éê„ÉÉ„Ç∞Ê©üËÉΩÔºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Âº∑ÂåñÔºâ
    function debugData() {
      showDebugPanel();
      updateStatus('„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±ÂèñÂæó‰∏≠', 'loading');
      
      safeCallGoogleScript('debugOrderData')
        .then(debugInfo => {
          const content = document.getElementById('debug-content');
          if (debugInfo && !debugInfo.error) {
            let html = `<strong>üìä „Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†± v5.3.0:</strong><br>`;
            html += `„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàID: ${debugInfo.spreadsheetId}<br>`;
            html += `„Ç∑„Éº„ÉàÂêç: ${debugInfo.sheetName}<br>`;
            html += `Á∑èË°åÊï∞: ${debugInfo.totalRows}<br>`;
            html += `Á∑èÂàóÊï∞: ${debugInfo.totalColumns}<br>`;
            html += `„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ: ${systemInitialized ? 'ÂÆå‰∫Ü' : 'Êú™ÂÆå‰∫Ü'}<br>`;
            html += `Êé•Á∂öÁä∂ÊÖã: ${isOnline ? '„Ç™„É≥„É©„Ç§„É≥' : '„Ç™„Éï„É©„Ç§„É≥'}<br>`;
            html += `ÂÜçË©¶Ë°åÂõûÊï∞: ${retryCount}/${maxRetries}<br><br>`;
            
            html += `<strong>üìù „Éò„ÉÉ„ÉÄ„ÉºË°å:</strong><br>`;
            debugInfo.headers.forEach((header, index) => {
              const columnLetter = getColumnLetter(index);
              html += `${columnLetter}Âàó(${index}): ${header}<br>`;
            });
            
            html += `<br><strong>üìÑ „Çµ„É≥„Éó„É´„Éá„Éº„ÇøË°å:</strong><br>`;
            debugInfo.sampleData.forEach((value, index) => {
              if (value !== '' && value !== null && value !== undefined) {
                const columnLetter = getColumnLetter(index);
                html += `${columnLetter}Âàó(${index}): ${value}<br>`;
              }
            });
            
            if (debugInfo.importantColumns) {
              html += `<br><strong>üîç ÈáçË¶ÅÂàó„Éá„Éº„Çø:</strong><br>`;
              Object.entries(debugInfo.importantColumns).forEach(([key, value]) => {
                html += `${key}: ${value}<br>`;
              });
            }
            
            if (debugInfo.systemConfig) {
              html += `<br><strong>‚öôÔ∏è „Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö:</strong><br>`;
              html += `„Éê„Éº„Ç∏„Éß„É≥: ${debugInfo.systemConfig.version}<br>`;
              html += `„Ç≠„É£„ÉÉ„Ç∑„É•ÊúâÂäπ: ${debugInfo.systemConfig.cache?.enabled || false}<br>`;
              html += `ÂèóÂèñÊôÇÈñìË®≠ÂÆö: ${debugInfo.systemConfig.pickupTimes?.start || 11}:00-${debugInfo.systemConfig.pickupTimes?.end || 17}:00<br>`;
            }
            
            content.innerHTML = html;
          } else {
            content.innerHTML = `„Ç®„É©„Éº: ${debugInfo?.error || '„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'}`;
          }
          updateStatus('„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±Ë°®Á§∫ÂÆå‰∫Ü', 'success');
        })
        .catch(error => {
          document.getElementById('debug-content').innerHTML = '„Ç®„É©„Éº: ' + error;
          updateStatus('„Éá„Éê„ÉÉ„Ç∞„Ç®„É©„Éº', 'error');
        });
    }

    // üîß Êñ∞Ë¶èËøΩÂä†ÔºöÂàóÊñáÂ≠óÂèñÂæóÈñ¢Êï∞
    function getColumnLetter(index) {
      if (index < 26) {
        return String.fromCharCode(65 + index);
      } else {
        const firstLetter = String.fromCharCode(64 + Math.floor(index / 26));
        const secondLetter = String.fromCharCode(65 + (index % 26));
        return firstLetter + secondLetter;
      }
    }

    function showDebugPanel() {
      document.getElementById('debug-panel').style.display = 'block';
      document.getElementById('debug-panel').scrollIntoView({ behavior: 'smooth' });
    }

    function hideDebugPanel() {
      document.getElementById('debug-panel').style.display = 'none';
    }

    // üîß Êñ∞Ë¶èËøΩÂä†Ôºö„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢Ê©üËÉΩ
    function clearSystemCache() {
      if (!systemInitialized) {
        showToast('„Ç∑„Çπ„ÉÜ„É†„ÅåÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
        return;
      }
      
      updateStatus('„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢‰∏≠', 'loading');
      
      safeCallGoogleScript('clearCache')
        .then(result => {
          if (result && result.success) {
            showToast(result.message, 'success');
            updateStatus('„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ÂÆå‰∫Ü', 'success');
            // „Éá„Éº„Çø„ÇíÂÜçË™≠„ÅøËæº„Åø
            setTimeout(() => {
              refreshAllData();
            }, 1000);
          } else {
            showToast('„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            updateStatus('„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢„Ç®„É©„Éº', 'error');
          }
        })
        .catch(error => {
          console.error('„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢„Ç®„É©„Éº:', error);
          showToast('„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
          updateStatus('„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢„Ç®„É©„Éº', 'error');
        });
    }

    // ‰∫àÁ¥Ñ„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Âº∑ÂåñÔºâ
    function loadOrdersData() {
      showLoading('orders');
      updateStatus('‰∫àÁ¥Ñ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠', 'loading');
      
      safeCallGoogleScript('getOrderList')
        .then(orders => {
          console.log('üìã ‰∫àÁ¥Ñ„Éá„Éº„ÇøÂèñÂæó:', orders);
          currentData.orders = orders || [];
          renderOrders();
          hideLoading('orders');
          updateStatus('Êõ¥Êñ∞ÂÆå‰∫Ü', 'success');
        })
        .catch(error => {
          console.error('‰∫àÁ¥Ñ„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
          showError('orders', '‰∫àÁ¥Ñ„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error);
          updateStatus('ÂèñÂæó„Ç®„É©„Éº', 'error');
        });
    }

    // Âú®Â∫´„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Âº∑ÂåñÔºâ
    function loadInventoryData() {
      showLoading('inventory');
      updateStatus('Âú®Â∫´„Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠', 'loading');
      
      safeCallGoogleScript('getInventoryDataForForm')
        .then(inventory => {
          currentData.inventory = inventory || [];
          renderInventory();
          hideLoading('inventory');
          updateStatus('Êõ¥Êñ∞ÂÆå‰∫Ü', 'success');
        })
        .catch(error => {
          console.error('Âú®Â∫´„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
          showError('inventory', 'Âú®Â∫´„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
          updateStatus('ÂèñÂæó„Ç®„É©„Éº', 'error');
        });
    }

    // „É°„Éã„É•„Éº„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÔºà„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Âº∑ÂåñÔºâ
    function loadMenuData() {
      showLoading('menu');
      updateStatus('„É°„Éã„É•„Éº„Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠', 'loading');
      
      safeCallGoogleScript('getProductMaster')
        .then(products => {
          currentData.products = products || [];
          renderMenu();
          hideLoading('menu');
          updateStatus('Êõ¥Êñ∞ÂÆå‰∫Ü', 'success');
        })
        .catch(error => {
          console.error('„É°„Éã„É•„Éº„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
          showError('menu', '„É°„Éã„É•„Éº„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
          updateStatus('ÂèñÂæó„Ç®„É©„Éº', 'error');
        });
    }

    // ‰ªäÂæå1ÈÄ±Èñì„ÅÆ‰∫àÁ¥ÑÁä∂Ê≥Å„ÇíÈõÜË®à„ÉªË°®Á§∫ÔºàÊó¢Â≠ò„ÅÆ„Åæ„ÅæÔºâ
    function getNext7DaysReservations(orders) {
      const today = new Date();
      today.setHours(0,0,0,0);
      const result = [];
      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        const dayOrders = orders.filter(order => order.pickupDate === dateStr);
        result.push({ 
          date: dateStr, 
          count: dayOrders.length, 
          orders: dayOrders,
          isToday: i === 0
        });
      }